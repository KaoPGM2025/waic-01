<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Zen 7.4.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #020617;
            --accent: #6366f1;
            --bg-glass: rgba(255, 255, 255, 0.8);
        }
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f1f5f9;
            color: #0f172a;
            overflow-x: hidden;
        }
        h1, h2, h3, .font-kanit { font-family: 'Kanit', sans-serif; }
        
        .glass-card {
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }

        .neo-button {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .neo-button:active { transform: scale(0.96); }

        .nav-active {
            color: var(--accent);
            position: relative;
        }
        .nav-active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--accent);
            border-radius: 50%;
        }

        .pin-cell {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #cbd5e1;
            transition: all 0.2s;
        }
        .pin-cell.filled {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
        }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
    </style>
</head>
<body class="pb-24 md:pb-0 md:pt-24">

    <!-- Auth System -->
    <div id="authOverlay" class="fixed inset-0 z-[100] bg-slate-50 flex flex-col items-center justify-center p-6">
        <div class="w-full max-w-xs text-center">
            <div class="mb-10 inline-block p-4 bg-white rounded-[2rem] shadow-xl rotate-3">
                <div class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center text-white text-3xl font-bold">Z</div>
            </div>
            <h1 class="text-2xl font-bold text-slate-900 mb-2">Finance Zen 7.4</h1>
            <p id="authHint" class="text-sm text-slate-500 mb-8">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN 4 ‡∏´‡∏•‡∏±‡∏Å</p>
            
            <div class="flex justify-center gap-4 mb-10">
                <div class="pin-cell"></div><div class="pin-cell"></div><div class="pin-cell"></div><div class="pin-cell"></div>
            </div>

            <input type="password" id="pinInput" maxlength="4" inputmode="numeric" class="absolute opacity-0" autofocus>
            
            <div class="grid grid-cols-3 gap-4 w-full">
                <!-- Custom Keypad for UX -->
                <button onclick="pressKey('1')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">1</button>
                <button onclick="pressKey('2')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">2</button>
                <button onclick="pressKey('3')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">3</button>
                <button onclick="pressKey('4')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">4</button>
                <button onclick="pressKey('5')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">5</button>
                <button onclick="pressKey('6')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">6</button>
                <button onclick="pressKey('7')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">7</button>
                <button onclick="pressKey('8')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">8</button>
                <button onclick="pressKey('9')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">9</button>
                <button class="h-16"></button>
                <button onclick="pressKey('0')" class="h-16 bg-white rounded-2xl text-xl font-bold shadow-sm active:bg-slate-100">0</button>
                <button onclick="pressKey('DEL')" class="h-16 text-slate-400 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12l6.414 6.414a2 2 0 001.414.586H19a2 2 0 002-2V7a2 2 0 00-2-2h-8.172a2 2 0 00-1.414.586L3 12z" /></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Top Navigation (Desktop) -->
    <nav class="hidden md:flex fixed top-0 left-0 right-0 h-20 bg-white/80 backdrop-blur-xl border-b border-slate-200 z-50 px-12 items-center justify-between">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-bold">Z</div>
            <h2 class="font-bold text-lg tracking-tight">Finance Zen <span class="text-indigo-600 font-normal">7.4 Nexus</span></h2>
        </div>
        <div class="flex gap-8 items-center">
            <button onclick="switchTab('home')" class="tab-btn font-bold text-sm nav-active" id="tab-home-d">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
            <button onclick="switchTab('history')" class="tab-btn font-bold text-sm text-slate-400" id="tab-history-d">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
            <button onclick="switchTab('settings')" class="tab-btn font-bold text-sm text-slate-400" id="tab-settings-d">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button>
        </div>
    </nav>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="md:hidden fixed bottom-6 left-6 right-6 h-16 bg-white/90 backdrop-blur-xl border border-white shadow-2xl rounded-[2rem] z-50 flex items-center justify-around px-4">
        <button onclick="switchTab('home')" class="tab-btn p-2" id="tab-home-m">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
        </button>
        <button onclick="switchTab('history')" class="tab-btn p-2 text-slate-400" id="tab-history-m">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        </button>
        <button onclick="switchTab('settings')" class="tab-btn p-2 text-slate-400" id="tab-settings-m">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        </button>
    </nav>

    <main class="max-w-5xl mx-auto p-6 md:py-12">
        
        <!-- Dashboard View -->
        <div id="view-home" class="animate-slide-up space-y-8">
            <header class="flex justify-between items-end">
                <div>
                    <h1 class="text-3xl font-bold tracking-tight">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µüëã</h1>
                    <p class="text-slate-500 text-sm">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Nexus Core</p>
                </div>
                <div class="hidden md:block text-right">
                    <p id="currentDate" class="text-xs font-bold text-slate-400 uppercase tracking-widest"></p>
                </div>
            </header>

            <!-- Balance Card -->
            <div class="glass-card bg-indigo-600 p-8 text-white relative overflow-hidden">
                <div class="relative z-10 flex flex-col md:flex-row justify-between md:items-center gap-6">
                    <div>
                        <p class="text-indigo-200 text-xs font-bold uppercase tracking-widest mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                        <h2 id="displayTotal" class="text-5xl font-bold tracking-tight">‡∏ø0.00</h2>
                    </div>
                    <div class="flex gap-4">
                        <div class="bg-white/10 p-4 rounded-2xl backdrop-blur-md flex-1 md:flex-none">
                            <p class="text-[10px] text-indigo-200 uppercase font-bold mb-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</p>
                            <p id="avgDaily" class="text-lg font-bold">‡∏ø0.00</p>
                        </div>
                        <div class="bg-white/10 p-4 rounded-2xl backdrop-blur-md flex-1 md:flex-none">
                            <p class="text-[10px] text-indigo-200 uppercase font-bold mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            <p id="totalItems" class="text-lg font-bold">0</p>
                        </div>
                    </div>
                </div>
                <!-- Design Elements -->
                <div class="absolute -right-20 -top-20 w-80 h-80 bg-white/10 rounded-full blur-3xl"></div>
                <div class="absolute -left-10 -bottom-10 w-40 h-40 bg-indigo-400/20 rounded-full blur-2xl"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Add Form -->
                <div class="glass-card p-6 lg:col-span-1">
                    <h3 class="font-bold mb-6 flex items-center gap-2">
                        <span class="w-1.5 h-6 bg-indigo-600 rounded-full"></span>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <form id="txForm" class="space-y-4">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                            <input type="text" id="txTitle" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå" required class="w-full p-4 bg-slate-100 rounded-2xl outline-none focus:ring-2 ring-indigo-100 transition-all font-medium border border-transparent focus:border-indigo-200">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                                <input type="number" id="txAmount" placeholder="0.00" step="0.01" required class="w-full p-4 bg-slate-100 rounded-2xl outline-none font-bold text-indigo-600 border border-transparent focus:border-indigo-200">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <select id="txCat" class="w-full p-4 bg-slate-100 rounded-2xl outline-none text-sm font-bold border border-transparent focus:border-indigo-200"></select>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-slate-900 text-white font-bold py-4 rounded-2xl neo-button shadow-lg shadow-slate-200 hover:bg-slate-800">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Nexus Vault</button>
                    </form>
                </div>

                <!-- Analysis -->
                <div class="glass-card p-6 lg:col-span-2 flex flex-col md:flex-row items-center gap-8">
                    <div class="w-full md:w-1/2">
                        <canvas id="mainChart" style="max-height: 250px;"></canvas>
                    </div>
                    <div class="w-full md:w-1/2 space-y-4">
                        <h3 class="font-bold text-sm text-slate-500 uppercase tracking-wider">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
                        <div id="catLegend" class="space-y-3"></div>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="space-y-4">
                <h3 class="font-bold px-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="recentList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
        </div>

        <!-- History View -->
        <div id="view-history" class="hidden animate-slide-up space-y-6">
            <div class="glass-card p-6 flex flex-col md:flex-row gap-4 items-center">
                <div class="relative flex-1">
                    <input type="text" id="searchBox" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà..." class="w-full pl-12 pr-4 py-4 bg-slate-100 rounded-2xl outline-none focus:bg-white border border-transparent focus:border-indigo-200 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-4 top-4.5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </div>
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="exportData()" class="px-6 py-4 bg-indigo-600 text-white rounded-2xl font-bold text-sm neo-button flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                    </button>
                </div>
            </div>
            <div id="historyGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Settings View -->
        <div id="view-settings" class="hidden animate-slide-up space-y-8">
            <div class="glass-card p-8">
                <h3 class="font-bold text-xl mb-8">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="space-y-6">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</label>
                            <div class="flex gap-2">
                                <input type="text" id="newCatName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô..." class="flex-1 p-4 bg-slate-100 rounded-2xl outline-none border border-transparent focus:border-indigo-200">
                                <button onclick="addCategory()" class="px-6 bg-slate-900 text-white rounded-2xl font-bold neo-button">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                            </div>
                        </div>
                        <div id="categoryTags" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div class="space-y-6 border-l border-slate-100 pl-0 md:pl-12">
                        <div class="p-6 bg-indigo-50 rounded-3xl border border-indigo-100">
                            <p class="text-[10px] font-bold text-indigo-400 uppercase mb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå Nexus</p>
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</span>
                                    <span class="font-bold">7.4.0 Quantum</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-500">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</span>
                                    <span class="text-emerald-600 font-bold flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2.166 4.9L9.03 9.103c.4.245.94.245 1.34 0L17.236 4.9a2.001 2.001 0 00-1.236-1.542l-5.4-1.8a2.002 2.002 0 00-1.2 0l-5.4 1.8a2.001 2.001 0 00-1.234 1.542zm15.634 1.543l-6.8 4.161c-.4.245-.94.245-1.34 0l-6.8-4.161A2 2 0 002 8.162V13a2 2 0 002 2h12a2 2 0 002-2V8.162a2 2 0 00-.2-1.719z" clip-rule="evenodd" /></svg>
                                        Vault Active
                                    </span>
                                </div>
                            </div>
                        </div>
                        <button onclick="resetPin()" class="w-full p-4 bg-white border border-slate-200 rounded-2xl text-sm font-bold neo-button">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™ PIN</button>
                    </div>
                </div>
            </div>

            <div class="glass-card p-8 border-red-100 bg-red-50/30">
                <h4 class="text-red-600 font-bold mb-2">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                <p class="text-xs text-slate-500 mb-6">‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Nexus Vault ‡∏ñ‡∏≤‡∏ß‡∏£</p>
                <div class="flex gap-4">
                    <button onclick="factoryReset()" class="flex-1 p-4 bg-white border border-red-100 text-red-600 font-bold rounded-2xl text-xs neo-button hover:bg-red-600 hover:text-white">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button onclick="location.reload()" class="flex-1 p-4 bg-slate-200 text-slate-600 font-bold rounded-2xl text-xs neo-button">‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÅ‡∏≠‡∏õ</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Alert System -->
    <div id="toast" class="fixed bottom-28 md:bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-[2rem] text-xs font-bold shadow-2xl opacity-0 translate-y-10 transition-all z-[200] flex items-center gap-3">
        <div class="w-2 h-2 bg-indigo-400 rounded-full animate-pulse"></div>
        <span id="toastMsg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>
    </div>

    <script>
        // --- Nexus Core Configuration ---
        const NEXUS_CONFIG = {
            mainKey: 'finance_zen_quantum_v74',
            catKey: 'nexus_cats_v74',
            pinKey: 'nexus_pin_v74',
            // All previous known keys for absolute data safety
            legacy: ['finance_zen_intelligence_v72', 'finance_zen_7', 'finance_zen_690', 'incomes_v313', 'incomes']
        };

        let state = {
            data: [],
            cats: ["‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏Å", "‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©", "‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏•", "‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"],
            pin: localStorage.getItem(NEXUS_CONFIG.pinKey),
            chart: null,
            pinInput: ''
        };

        // --- Data Shield Migration Engine ---
        const bootSystem = () => {
            let coreVault = [];
            let tracker = new Set();

            // 1. Scan Current
            const current = localStorage.getItem(NEXUS_CONFIG.mainKey);
            if (current) try { coreVault = JSON.parse(current); } catch(e){}

            // 2. Scan Legacy (The Data Guardian)
            NEXUS_CONFIG.legacy.forEach(key => {
                const raw = localStorage.getItem(key);
                if (raw) {
                    try {
                        const parsed = JSON.parse(raw);
                        if (Array.isArray(parsed)) {
                            parsed.forEach(item => {
                                // Unique footprint to prevent duplicates
                                const foot = `${item.title}-${item.amount}-${item.date}`;
                                if (!tracker.has(foot)) {
                                    const exists = coreVault.some(v => `${v.title}-${v.amount}-${v.date}` === foot);
                                    if (!exists) coreVault.push(item);
                                    tracker.add(foot);
                                }
                            });
                        }
                    } catch(e){}
                }
            });

            // 3. Finalize State
            state.data = coreVault.sort((a,b) => new Date(b.date) - new Date(a.date));
            
            const savedCats = localStorage.getItem(NEXUS_CONFIG.catKey);
            if (savedCats) state.cats = JSON.parse(savedCats);

            syncVault();
        };

        const syncVault = () => {
            localStorage.setItem(NEXUS_CONFIG.mainKey, JSON.stringify(state.data));
            localStorage.setItem(NEXUS_CONFIG.catKey, JSON.stringify(state.cats));
        };

        // --- Auth UI Logic ---
        const pressKey = (key) => {
            if (key === 'DEL') {
                state.pinInput = state.pinInput.slice(0, -1);
            } else if (state.pinInput.length < 4) {
                state.pinInput += key;
            }
            updatePinDots();
            if (state.pinInput.length === 4) checkAuth();
        };

        const updatePinDots = () => {
            const dots = document.querySelectorAll('.pin-cell');
            dots.forEach((d, i) => d.classList.toggle('filled', i < state.pinInput.length));
        };

        const checkAuth = () => {
            if (!state.pin) {
                state.pin = state.pinInput;
                localStorage.setItem(NEXUS_CONFIG.pinKey, state.pin);
                unlockVault();
                showToast("‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™ PIN ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            } else if (state.pinInput === state.pin) {
                unlockVault();
            } else {
                state.pinInput = '';
                updatePinDots();
                document.getElementById('authHint').innerText = "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
                document.getElementById('authHint').classList.add('text-red-500');
            }
        };

        const unlockVault = () => {
            const overlay = document.getElementById('authOverlay');
            overlay.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                overlay.style.display = 'none';
                renderHome();
            }, 400);
        };

        // --- Dashboard & Tabs ---
        const switchTab = (tab) => {
            document.querySelectorAll('main > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(`view-${tab}`).classList.remove('hidden');

            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('nav-active', 'text-slate-900'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.add('text-slate-400'));
            
            document.getElementById(`tab-${tab}-m`).classList.add('nav-active', 'text-slate-900');
            document.getElementById(`tab-${tab}-d`).classList.add('nav-active', 'text-slate-900');

            if (tab === 'home') renderHome();
            if (tab === 'history') renderHistory();
            if (tab === 'settings') renderSettings();
        };

        const renderHome = () => {
            const now = new Date();
            document.getElementById('currentDate').innerText = now.toLocaleDateString('th-TH', { weekday:'long', day:'numeric', month:'long' });

            const total = state.data.reduce((acc, cur) => acc + parseFloat(cur.amount), 0);
            const count = state.data.length;
            const avg = count > 0 ? (total / count) : 0;

            const format = (v) => new Intl.NumberFormat('th-TH', { minimumFractionDigits: 2 }).format(v);
            document.getElementById('displayTotal').innerText = `‡∏ø${format(total)}`;
            document.getElementById('avgDaily').innerText = `‡∏ø${format(avg)}`;
            document.getElementById('totalItems').innerText = count;

            // Form Logic
            const catSel = document.getElementById('txCat');
            catSel.innerHTML = state.cats.map(c => `<option value="${c}">${c}</option>`).join('');

            // Analytics Logic
            const catMap = {};
            state.data.forEach(i => catMap[i.category] = (catMap[i.category] || 0) + parseFloat(i.amount));

            const labels = Object.keys(catMap);
            const values = Object.values(catMap);
            const colors = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#8b5cf6'];

            if (state.chart) state.chart.destroy();
            const ctx = document.getElementById('mainChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    cutout: '82%',
                    plugins: { legend: { display: false } }
                }
            });

            document.getElementById('catLegend').innerHTML = labels.map((l, i) => `
                <div class="flex justify-between items-center text-xs">
                    <div class="flex items-center gap-2">
                        <div class="w-2.5 h-2.5 rounded-full" style="background: ${colors[i % colors.length]}"></div>
                        <span class="font-bold text-slate-600">${l}</span>
                    </div>
                    <span class="font-black text-slate-900">${((values[i]/total)*100 || 0).toFixed(1)}%</span>
                </div>
            `).join('');

            // Recent List
            const recent = state.data.slice(0, 4);
            document.getElementById('recentList').innerHTML = recent.map(i => `
                <div class="glass-card p-5 flex justify-between items-center hover:bg-slate-50 transition-colors">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">${i.title}</p>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">${i.category}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-black text-slate-900">‡∏ø${i.amount.toLocaleString()}</p>
                        <p class="text-[9px] text-slate-400 font-medium">${new Date(i.date).toLocaleDateString('th-TH')}</p>
                    </div>
                </div>
            `).join('') || '<p class="col-span-full text-center py-10 text-slate-300 font-bold italic">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>';
        };

        const renderHistory = () => {
            const query = document.getElementById('searchBox').value.toLowerCase();
            const filtered = state.data.filter(i => 
                i.title.toLowerCase().includes(query) || i.category.toLowerCase().includes(query)
            );

            document.getElementById('historyGrid').innerHTML = filtered.map(i => `
                <div class="glass-card p-5 flex justify-between items-center group">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-white border border-slate-100 rounded-xl">
                            <p class="text-[9px] font-black text-slate-400 text-center uppercase leading-none">${new Date(i.date).toLocaleDateString('th-TH', {day:'numeric'})}<br>${new Date(i.date).toLocaleDateString('th-TH', {month:'short'})}</p>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">${i.title}</p>
                            <span class="text-[9px] bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded-md font-bold">${i.category}</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="font-black text-slate-900">‡∏ø${i.amount.toLocaleString()}</span>
                        <button onclick="removeItem(${i.id})" class="p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                    </div>
                </div>
            `).join('') || '<p class="col-span-full text-center py-20 text-slate-300 font-bold">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>';
        };

        const renderSettings = () => {
            document.getElementById('categoryTags').innerHTML = state.cats.map(c => `
                <div class="px-4 py-2 bg-white border border-slate-100 rounded-2xl flex items-center gap-3 shadow-sm">
                    <span class="text-xs font-bold text-slate-700">${c}</span>
                    <button onclick="removeCat('${c}')" class="text-slate-300 hover:text-red-500 font-bold text-lg leading-none">&times;</button>
                </div>
            `).join('');
        };

        // --- Core Interactions ---
        document.getElementById('txForm').onsubmit = (e) => {
            e.preventDefault();
            const tx = {
                id: Date.now(),
                title: document.getElementById('txTitle').value,
                amount: parseFloat(document.getElementById('txAmount').value),
                category: document.getElementById('txCat').value,
                date: new Date().toISOString().split('T')[0]
            };
            state.data.unshift(tx);
            syncVault();
            e.target.reset();
            renderHome();
            showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á Vault ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        };

        const removeItem = (id) => {
            if (confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?")) {
                state.data = state.data.filter(i => i.id !== id);
                syncVault();
                renderHistory();
                showToast("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß");
            }
        };

        const addCategory = () => {
            const name = document.getElementById('newCatName').value.trim();
            if (name && !state.cats.includes(name)) {
                state.cats.push(name);
                syncVault();
                renderSettings();
                document.getElementById('newCatName').value = '';
            }
        };

        const removeCat = (c) => {
            if (state.cats.length > 1) {
                state.cats = state.cats.filter(cat => cat !== c);
                syncVault();
                renderSettings();
            }
        };

        const exportData = () => {
            const blob = new Blob([JSON.stringify(state.data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nexus_quantum_export_${new Date().getTime()}.json`;
            a.click();
            showToast("‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        };

        const resetPin = () => {
            const old = prompt("‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:");
            if (old === state.pin) {
                const next = prompt("‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN ‡πÉ‡∏´‡∏°‡πà 4 ‡∏´‡∏•‡∏±‡∏Å:");
                if (next && next.length === 4) {
                    state.pin = next;
                    localStorage.setItem(NEXUS_CONFIG.pinKey, next);
                    showToast("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                }
            } else { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
        };

        const factoryReset = () => {
            if (confirm("‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?")) {
                localStorage.clear();
                location.reload();
            }
        };

        const showToast = (msg) => {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-10'), 3000);
        };

        // --- Launch ---
        window.onload = () => {
            bootSystem();
            document.getElementById('searchBox').oninput = renderHistory;
            if (!state.pin) {
                document.getElementById('authHint').innerText = "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™ PIN 4 ‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏£‡∏Å";
            }
        };

    </script>
</body>
</html>
