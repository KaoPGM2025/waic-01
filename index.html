<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Nexus v64.0.0 MetaAI 7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --meta-ai-v7-glow: #10b981; /* ‡∏™‡∏µ‡∏°‡∏£‡∏Å‡∏ï‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÉ‡∏´‡∏°‡πà */
            --meta-ai-v7-deep: #064e3b;
            --bg-dark: #020617;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% -20%, #1e1b4b 0%, #020617 80%);
            color: #f1f5f9;
            /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î */
            font-size: 18.5px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .font-kanit { font-family: 'Kanit', sans-serif; }

        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 24px;
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }

        .v7-badge {
            background: linear-gradient(135deg, #10b981, #3b82f6);
            color: white;
            padding: 2px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }

        .input-v7 {
            background: rgba(2, 6, 23, 0.6);
            border: 1px solid rgba(16, 185, 129, 0.1);
            border-radius: 14px;
            padding: 14px;
            color: white;
            width: 100%;
            transition: all 0.3s;
        }

        .input-v7:focus {
            outline: none;
            border-color: var(--meta-ai-v7-glow);
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1);
        }

        .btn-v7 {
            background: linear-gradient(to right, #10b981, #059669);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 14px;
            padding: 14px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.2);
        }

        .btn-v7:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .progress-container {
            height: 14px;
            background: #1e293b;
            border-radius: 100px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399, #60a5fa);
            border-radius: 100px;
            transition: width 1s ease-in-out;
        }

        .ai-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <!-- Dashboard Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6">
            <div>
                <div class="flex items-center gap-3 mb-3">
                    <span class="v7-badge ai-pulse">v64.0.0 MetaAI 7.0</span>
                    <span class="text-slate-500 text-sm">Neural Engine Active</span>
                </div>
                <h1 class="text-4xl font-bold font-kanit text-white">Finance <span class="text-emerald-400">Nexus</span></h1>
            </div>
            <div class="glass-card px-8 py-5 border-emerald-500/10">
                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                <h2 id="balance" class="text-5xl font-bold font-kanit text-emerald-400">‡∏ø0.00</h2>
            </div>
        </header>

        <!-- MetaAI v7.0 Analysis Panel -->
        <div class="glass-card p-7 mb-10 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10">
                <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor" class="text-emerald-400"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2z"/></svg>
            </div>
            <div class="flex items-start gap-4 mb-4">
                <div class="bg-emerald-500/20 p-3 rounded-2xl">
                    <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </div>
                <div>
                    <h3 class="font-bold font-kanit text-xl text-white">MetaAI 7.0 Smart Analysis</h3>
                    <div id="aiAnalysis" class="text-slate-300 mt-2">
                        <span class="italic text-slate-500">Neural Engine: ‡∏™‡πÅ‡∏ï‡∏ô‡∏î‡πå‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Side: Controls & Goal -->
            <div class="lg:col-span-4 flex flex-col gap-8">
                <!-- Goal Achievement -->
                <div class="glass-card p-6 border-l-4 border-l-emerald-500">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="font-bold font-kanit text-white">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h4>
                        <button onclick="toggleGoalModal()" class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-emerald-400 hover:bg-emerald-500 hover:text-white transition-all">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" stroke-width="2"/></svg>
                        </button>
                    </div>
                    <div id="goalContent" class="space-y-4">
                        <div class="flex justify-between items-end">
                            <span id="goalLabel" class="text-slate-200 font-medium">--</span>
                            <span id="goalPercent" class="text-3xl font-bold font-kanit text-emerald-400">0%</span>
                        </div>
                        <div class="progress-container">
                            <div id="goalBar" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-slate-500">
                            <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                            <span id="goalSummary">‡∏ø0 / ‡∏ø0</span>
                        </div>
                    </div>
                </div>

                <!-- Input Panel -->
                <div class="glass-card p-6">
                    <h4 class="font-bold font-kanit text-white mb-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h4>
                    <form id="txForm" class="space-y-5">
                        <div class="space-y-2">
                            <label class="text-xs text-slate-400 uppercase font-bold px-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                            <input type="text" id="itemName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£" class="input-v7" required>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="space-y-2">
                                <label class="text-xs text-slate-400 uppercase font-bold px-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                                <select id="itemType" class="input-v7">
                                    <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                                    <option value="expense" selected>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs text-slate-400 uppercase font-bold px-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                                <input type="number" id="itemAmount" placeholder="0.00" class="input-v7" required>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs text-slate-400 uppercase font-bold px-1">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="itemCat" class="input-v7">
                                <option value="Salary">üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏Å</option>
                                <option value="Food">üç± ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                                <option value="Transport">üöï ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                                <option value="Housing">üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ö‡∏¥‡∏•</option>
                                <option value="Health">üíä ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                                <option value="Other">‚ú® ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-v7 w-full font-kanit text-lg mt-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
                    </form>
                </div>
            </div>

            <!-- Right Side: Analytics & History -->
            <div class="lg:col-span-8 flex flex-col gap-8">
                <!-- Auto-updating Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-card p-6 min-h-[320px] flex flex-col">
                        <h4 class="text-sm font-bold text-slate-400 mb-6 uppercase tracking-wider">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (Neural Map)</h4>
                        <div class="flex-grow">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                    <div class="glass-card p-6 min-h-[320px] flex flex-col">
                        <h4 class="text-sm font-bold text-slate-400 mb-6 uppercase tracking-wider">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (Pulse)</h4>
                        <div class="flex-grow">
                            <canvas id="lineChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Transaction History -->
                <div class="glass-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="font-bold font-kanit text-white">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                        <span id="countDisplay" class="text-xs bg-slate-800 text-slate-400 py-1 px-3 rounded-full">0 ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</span>
                    </div>
                    <div id="txList" class="space-y-4 max-h-[400px] overflow-y-auto pr-3">
                        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-slate-950/80 backdrop-blur-md hidden items-center justify-center p-4 z-50">
        <div class="glass-card p-8 w-full max-w-md border-emerald-500/40">
            <h3 class="text-2xl font-bold font-kanit mb-6 text-emerald-400">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ AI</h3>
            <div class="space-y-5">
                <input type="text" id="setGoalName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≠‡∏Å‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà)" class="input-v7">
                <input type="number" id="setGoalTarget" placeholder="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö (‡∏ö‡∏≤‡∏ó)" class="input-v7">
                <div class="flex gap-3 pt-2">
                    <button onclick="saveGoal()" class="btn-v7 flex-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button onclick="toggleGoalModal()" class="flex-1 bg-slate-800 text-slate-400 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database Versioning for v64.0.0
        const DB_KEY = 'meta_finance_v64';
        const PREV_KEYS = ['meta_finance_v62', 'meta_finance_v60'];

        let state = {
            transactions: [],
            goal: { name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞", target: 50000 },
            lastUpdate: Date.now()
        };

        let charts = { pie: null, line: null };

        // 1. Data Management (Migration Logic)
        function initSystem() {
            const currentData = localStorage.getItem(DB_KEY);
            
            if (currentData) {
                state = JSON.parse(currentData);
            } else {
                // Check older versions for migration
                for (let key of PREV_KEYS) {
                    const oldData = localStorage.getItem(key);
                    if (oldData) {
                        const parsedOld = JSON.parse(oldData);
                        state.transactions = parsedOld.transactions || [];
                        state.goal = parsedOld.goal || state.goal;
                        console.log(`v64: Migrated data from ${key} successfully.`);
                        break; 
                    }
                }
                saveState();
            }
            refreshUI();
        }

        function saveState() {
            localStorage.setItem(DB_KEY, JSON.stringify(state));
            refreshUI();
        }

        // 2. Core Rendering
        function refreshUI() {
            const income = state.transactions.filter(t => t.type === 'income').reduce((s, t) => s + Number(t.amt), 0);
            const expense = state.transactions.filter(t => t.type === 'expense').reduce((s, t) => s + Number(t.amt), 0);
            const balance = income - expense;

            // Balance
            document.getElementById('balance').innerText = `‡∏ø${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;

            // Goal Logic
            document.getElementById('goalLabel').innerText = state.goal.name;
            const rawPercent = state.goal.target > 0 ? (balance / state.goal.target) * 100 : 0;
            const displayPercent = Math.max(0, Math.min(100, rawPercent)).toFixed(1);
            document.getElementById('goalPercent').innerText = `${displayPercent}%`;
            document.getElementById('goalBar').style.width = `${displayPercent}%`;
            document.getElementById('goalSummary').innerText = `‡∏ø${balance.toLocaleString()} / ‡∏ø${state.goal.target.toLocaleString()}`;

            // List
            renderList();
            
            // AI Analysis (Trigger MetaAI 7.0)
            analyzeNeural(balance, income, expense);
            
            // Auto Charts
            updateVisuals();
        }

        function renderList() {
            const list = document.getElementById('txList');
            document.getElementById('countDisplay').innerText = `${state.transactions.length} ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°`;
            
            if (state.transactions.length === 0) {
                list.innerHTML = `<div class="text-center py-10 text-slate-600 italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>`;
                return;
            }

            list.innerHTML = state.transactions.slice().reverse().map((t, idx) => `
                <div class="flex justify-between items-center p-5 bg-slate-900/50 rounded-2xl border border-slate-800 hover:border-emerald-500/30 transition-all group">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-slate-800 flex items-center justify-center text-xl shadow-inner">
                            ${getIcon(t.cat)}
                        </div>
                        <div>
                            <div class="font-bold text-slate-100">${t.name}</div>
                            <div class="text-xs text-slate-500">${new Date(t.date).toLocaleString('th-TH')}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <div class="font-bold font-kanit ${t.type === 'income' ? 'text-emerald-400' : 'text-blue-400'}">
                                ${t.type === 'income' ? '+' : '-'} ${Number(t.amt).toLocaleString()}
                            </div>
                            <div class="text-[10px] uppercase text-slate-600 tracking-widest">${t.cat}</div>
                        </div>
                        <button onclick="removeTx(${state.transactions.length - 1 - idx})" class="opacity-0 group-hover:opacity-100 p-2 text-slate-700 hover:text-red-500 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" stroke-width="2"/></svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getIcon(cat) {
            const icons = { Salary: 'üí∞', Food: 'üç±', Transport: 'üöï', Housing: 'üè†', Health: 'üíä', Other: '‚ú®' };
            return icons[cat] || 'üìù';
        }

        // 3. MetaAI 7.0 Analysis Logic
        function analyzeNeural(balance, income, expense) {
            const aiView = document.getElementById('aiAnalysis');
            
            // Rule: No data = No analysis
            if (state.transactions.length === 0) {
                aiView.innerHTML = `<span class="italic text-slate-500">Neural Engine: ‡∏™‡πÅ‡∏ï‡∏ô‡∏î‡πå‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ)</span>`;
                return;
            }

            const expRate = income > 0 ? (expense / income) * 100 : 100;
            let status = { text: "", color: "", advice: "" };

            if (balance < 0) {
                status = { text: "‡∏ß‡∏¥‡∏Å‡∏§‡∏ï (‡∏ï‡∏¥‡∏î‡∏•‡∏ö)", color: "text-red-400", advice: "MetaAI ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏†‡∏≤‡∏ß‡∏∞‡∏ï‡∏¥‡∏î‡∏•‡∏ö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Neural Balance ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å" };
            } else if (expRate > 80) {
                status = { text: "‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á (‡∏ï‡∏∂‡∏á‡∏ï‡∏±‡∏ß)", color: "text-orange-400", advice: "‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡∏á‡∏ñ‡∏∂‡∏á " + expRate.toFixed(1) + "% ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö 20% ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ñ‡∏±‡∏î‡πÑ‡∏õ" };
            } else if (balance >= state.goal.target) {
                status = { text: "‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á)", color: "text-emerald-400", advice: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß MetaAI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ó‡∏µ‡πà‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô" };
            } else {
                status = { text: "‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á)", color: "text-blue-400", advice: "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡∏´‡∏≤‡∏Å‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ " + state.goal.name + " ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£" };
            }

            aiView.innerHTML = `
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-xs font-bold uppercase tracking-widest text-slate-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô:</span>
                    <span class="font-bold font-kanit ${status.color}">${status.text}</span>
                </div>
                <div class="text-slate-300 leading-relaxed">${status.advice}</div>
            `;
        }

        // 4. Auto Charts (Pulse Generation)
        function updateVisuals() {
            // Pie Chart (Expense Categories)
            const catTotals = {};
            state.transactions.filter(t => t.type === 'expense').forEach(t => {
                catTotals[t.cat] = (catTotals[t.cat] || 0) + Number(t.amt);
            });

            if (charts.pie) charts.pie.destroy();
            charts.pie = new Chart(document.getElementById('pieChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catTotals),
                    datasets: [{
                        data: Object.values(catTotals),
                        backgroundColor: ['#10b981', '#3b82f6', '#6366f1', '#f59e0b', '#ec4899', '#94a3b8'],
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'bottom', labels: { color: '#94a3b8', font: { family: 'Sarabun', size: 12 }, padding: 20 } }
                    },
                    cutout: '70%'
                }
            });

            // Line Chart (Pulse Trend)
            let current = 0;
            const trend = state.transactions.map(t => {
                current += (t.type === 'income' ? Number(t.amt) : -Number(t.amt));
                return current;
            }).slice(-12);

            if (charts.line) charts.line.destroy();
            charts.line = new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: {
                    labels: trend.map((_, i) => i + 1),
                    datasets: [{
                        label: 'Balance Pulse',
                        data: trend,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointBackgroundColor: '#10b981'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // 5. Handlers
        document.getElementById('txForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const tx = {
                id: Date.now(),
                name: document.getElementById('itemName').value,
                amt: parseFloat(document.getElementById('itemAmount').value),
                type: document.getElementById('itemType').value,
                cat: document.getElementById('itemCat').value,
                date: new Date().toISOString()
            };
            state.transactions.push(tx);
            saveState();
            e.target.reset();
        });

        function removeTx(idx) {
            state.transactions.splice(idx, 1);
            saveState();
        }

        function toggleGoalModal() {
            const m = document.getElementById('goalModal');
            m.classList.toggle('hidden');
            m.classList.toggle('flex');
            document.getElementById('setGoalName').value = state.goal.name;
            document.getElementById('setGoalTarget').value = state.goal.target;
        }

        function saveGoal() {
            state.goal.name = document.getElementById('setGoalName').value || "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢";
            state.goal.target = Number(document.getElementById('setGoalTarget').value) || 0;
            saveState();
            toggleGoalModal();
        }

        // Initial Run
        window.onload = initSystem;
    </script>
</body>
</html>
