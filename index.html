<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Hyperion 24.3.26</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700;800&family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --hyper-blue: #2563eb;
            --hyper-gold: #fbbf24;
            --hyper-green: #10b981;
            --hyper-red: #ef4444;
        }
        body { font-family: 'Sarabun', sans-serif; background-color: #020617; color: #f8fafc; min-height: 100vh; }
        .font-kanit { font-family: 'Kanit', sans-serif; }
        .glass-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 24px; }
        .status-on { color: var(--hyper-green); box-shadow: 0 0 15px rgba(16, 185, 129, 0.3); }
        .status-off { color: var(--hyper-red); box-shadow: 0 0 15px rgba(239, 68, 68, 0.3); }
        .goal-progress { transition: width 1s ease-in-out; }
        .system-locked { pointer-events: none; opacity: 0.3; filter: grayscale(1); }
        
        /* Custom Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--hyper-green); }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-2xl mx-auto space-y-6">
        <!-- Header -->
        <header class="flex justify-between items-center glass-card p-6">
            <div>
                <h1 class="font-black text-xl tracking-tighter text-blue-500">HYPERION <span class="text-white font-light">24.3.26</span></h1>
                <p class="text-[10px] opacity-40 font-bold uppercase tracking-widest">Ultimate Financial Engine</p>
            </div>
            <div class="flex flex-col items-end gap-1">
                <div class="flex items-center gap-2">
                    <span id="statusTxt" class="text-[10px] font-black uppercase">Online</span>
                    <label class="switch">
                        <input type="checkbox" id="systemToggle" checked onchange="toggleSystem()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </header>

        <!-- Balance Card -->
        <section class="glass-card p-8 bg-gradient-to-br from-blue-600/20 to-transparent border-blue-500/20">
            <div class="text-center">
                <p class="text-xs font-bold opacity-60 mb-1 uppercase tracking-widest">Available Funds</p>
                <h2 id="balance" class="text-5xl font-black font-kanit">฿0.00</h2>
            </div>
            <div class="grid grid-cols-2 gap-4 mt-8">
                <div class="bg-white/5 p-4 rounded-2xl">
                    <p class="text-[10px] opacity-50 uppercase font-bold">Monthly In</p>
                    <p id="totalIn" class="text-xl font-bold text-emerald-400 font-kanit">฿0.00</p>
                </div>
                <div class="bg-white/5 p-4 rounded-2xl text-right">
                    <p class="text-[10px] opacity-50 uppercase font-bold">Monthly Out</p>
                    <p id="totalOut" class="text-xl font-bold text-rose-400 font-kanit">฿0.00</p>
                </div>
            </div>
        </section>

        <!-- Financial Goals Section -->
        <section id="goalSection" class="glass-card p-6 border-amber-500/20">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-black font-kanit text-sm uppercase text-amber-500 tracking-widest">Financial Goal</h3>
                <button onclick="openGoalSettings()" class="text-[10px] bg-amber-500/10 text-amber-500 px-3 py-1 rounded-full font-bold">SETTINGS</button>
            </div>
            
            <div id="goalDisplay">
                <div class="flex justify-between text-xs mb-2 font-bold">
                    <span id="goalNameDisplay">กำลังโหลดเป้าหมาย...</span>
                    <span id="goalPercentDisplay">0%</span>
                </div>
                <div class="w-full bg-slate-800 h-3 rounded-full overflow-hidden">
                    <div id="goalBar" class="goal-progress h-full bg-gradient-to-r from-amber-500 to-yellow-300" style="width: 0%"></div>
                </div>
                <p class="text-[10px] opacity-50 mt-2 text-right font-bold">
                    <span id="goalCurrentDisplay">฿0</span> / <span id="goalTargetDisplay">฿0</span>
                </p>
            </div>

            <!-- Goal Completion Alert -->
            <div id="goalAlert" class="hidden mt-4 p-3 bg-emerald-500/20 border border-emerald-500/50 rounded-xl text-center">
                <p class="text-xs font-bold text-emerald-400">สำเร็จแล้ว! ระบบจะรีเซ็ตใน <span id="countdown">10</span> วินาที</p>
            </div>
        </section>

        <!-- Input Section -->
        <section id="inputContainer" class="glass-card p-6">
            <form id="txForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="title" placeholder="รายการ..." required class="bg-slate-900 border border-slate-700 p-4 rounded-2xl outline-none focus:border-blue-500 transition-all">
                <input type="number" id="amount" placeholder="จำนวนเงิน..." required class="bg-slate-900 border border-slate-700 p-4 rounded-2xl outline-none focus:border-blue-500 transition-all font-bold text-blue-400">
                <select id="type" class="bg-slate-900 border border-slate-700 p-4 rounded-2xl font-bold">
                    <option value="expense">รายจ่าย (-)</option>
                    <option value="income">รายรับ (+)</option>
                </select>
                <button type="submit" class="bg-blue-600 hover:bg-blue-500 text-white font-black py-4 rounded-2xl transition-all shadow-lg shadow-blue-600/20 uppercase text-xs tracking-widest">บันทึกรายการ</button>
            </form>
        </section>

        <!-- History -->
        <div class="space-y-3">
            <h3 class="px-4 text-[10px] font-black opacity-40 uppercase tracking-[0.3em]">Active History (2 Days)</h3>
            <div id="logs" class="space-y-2"></div>
        </div>
    </div>

    <!-- Goal Settings Modal -->
    <div id="goalModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="glass-card p-8 w-full max-w-sm border-amber-500/30">
            <h2 class="text-xl font-black font-kanit mb-6 text-amber-500">GOAL SETTINGS</h2>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold opacity-50 uppercase">ชื่อเป้าหมาย</label>
                    <input type="text" id="setGoalName" class="w-full bg-slate-900 p-4 rounded-xl mt-1 border border-slate-700">
                </div>
                <div>
                    <label class="text-[10px] font-bold opacity-50 uppercase">ยอดที่ต้องการ (บาท)</label>
                    <input type="number" id="setGoalTarget" class="w-full bg-slate-900 p-4 rounded-xl mt-1 border border-slate-700 text-amber-500 font-bold">
                </div>
                <div class="flex gap-3 pt-4">
                    <button onclick="closeGoalSettings()" class="flex-1 py-3 font-bold opacity-50">ยกเลิก</button>
                    <button onclick="saveGoalSettings()" class="flex-1 py-3 bg-amber-500 text-black font-black rounded-xl">บันทึก</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'finance_zen_supernova_v151'; // คงเดิมเพื่อข้อมูลไม่หาย
        const GOAL_KEY = 'nexus_goal_v24';
        const STATE_KEY = 'nexus_state_v24';

        let data = {
            transactions: [],
            isOnline: true,
            goal: { name: 'เงินออมเพื่ออนาคต', target: 10000, current: 0, isProcessing: false }
        };

        function init() {
            // โหลดข้อมูลเดิม
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) data.transactions = JSON.parse(savedData);

            const savedGoal = localStorage.getItem(GOAL_KEY);
            if (savedGoal) data.goal = JSON.parse(savedGoal);

            const savedState = localStorage.getItem(STATE_KEY);
            if (savedState) data.isOnline = JSON.parse(savedState);

            document.getElementById('systemToggle').checked = data.isOnline;
            
            autoPurge();
            toggleSystem();
            render();
        }

        function autoPurge() {
            const now = new Date();
            let changed = false;
            data.transactions = data.transactions.map(tx => {
                const diff = (now - new Date(tx.date)) / (1000 * 60 * 60);
                if (diff >= 48 && !tx.isArchived) {
                    changed = true;
                    return { ...tx, isArchived: true };
                }
                return tx;
            });
            if (changed) save();
        }

        function toggleSystem() {
            data.isOnline = document.getElementById('systemToggle').checked;
            localStorage.setItem(STATE_KEY, JSON.stringify(data.isOnline));
            
            const container = document.getElementById('inputContainer');
            const statusTxt = document.getElementById('statusTxt');
            
            if (data.isOnline) {
                container.classList.remove('system-locked');
                statusTxt.innerText = "Online";
                statusTxt.className = "text-[10px] font-black uppercase status-on";
            } else {
                container.classList.add('system-locked');
                statusTxt.innerText = "Offline";
                statusTxt.className = "text-[10px] font-black uppercase status-off";
            }
        }

        function render() {
            let totalBalance = 0, mIn = 0, mOut = 0;
            const now = new Date();

            data.transactions.forEach(tx => {
                const amt = parseFloat(tx.amount);
                const txDate = new Date(tx.date);
                if (tx.type === 'income') {
                    totalBalance += amt;
                    if (txDate.getMonth() === now.getMonth()) mIn += amt;
                } else {
                    totalBalance -= amt;
                    if (txDate.getMonth() === now.getMonth()) mOut += amt;
                }
            });

            // Update UI
            const fmt = (n) => new Intl.NumberFormat('th-TH', { minimumFractionDigits: 2 }).format(n);
            document.getElementById('balance').innerText = `฿${fmt(totalBalance)}`;
            document.getElementById('totalIn').innerText = `฿${fmt(mIn)}`;
            document.getElementById('totalOut').innerText = `฿${fmt(mOut)}`;

            // Goal Logic
            updateGoalUI(totalBalance);

            // History Logic
            const logs = document.getElementById('logs');
            const activeTxs = data.transactions
                .filter(tx => !tx.isArchived)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            logs.innerHTML = activeTxs.map(tx => `
                <div class="glass-card p-4 flex justify-between items-center">
                    <div>
                        <p class="font-bold text-sm">${tx.title}</p>
                        <p class="text-[9px] opacity-40 uppercase">${new Date(tx.date).toLocaleString('th-TH')}</p>
                    </div>
                    <p class="font-kanit font-bold ${tx.type === 'income' ? 'text-emerald-400' : 'text-rose-400'}">
                        ${tx.type === 'income' ? '+' : '-'}฿${fmt(tx.amount)}
                    </p>
                </div>
            `).join('');
        }

        function updateGoalUI(currentBalance) {
            const goal = data.goal;
            const progress = Math.min((currentBalance / goal.target) * 100, 100).toFixed(1);
            
            document.getElementById('goalNameDisplay').innerText = goal.name;
            document.getElementById('goalPercentDisplay').innerText = `${progress}%`;
            document.getElementById('goalBar').style.width = `${progress}%`;
            document.getElementById('goalCurrentDisplay').innerText = `฿${currentBalance.toLocaleString()}`;
            document.getElementById('goalTargetDisplay').innerText = `฿${goal.target.toLocaleString()}`;

            if (progress >= 100 && !goal.isProcessing) {
                triggerGoalCompletion();
            }
        }

        function triggerGoalCompletion() {
            data.goal.isProcessing = true;
            document.getElementById('goalAlert').classList.remove('hidden');
            let sec = 10;
            const cd = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                sec--;
                cd.innerText = sec;
                if (sec <= 0) {
                    clearInterval(timer);
                    // ลบเป้าหมายอัตโนมัติ
                    document.getElementById('goalDisplay').style.opacity = '0';
                    document.getElementById('goalAlert').innerHTML = '<p class="text-xs font-bold text-blue-400">กำลังเตรียมเป้าหมายใหม่ใน 3 วินาที...</p>';
                    
                    setTimeout(() => {
                        // Reset Goal
                        data.goal = { name: 'เป้าหมายใหม่', target: 20000, current: 0, isProcessing: false };
                        saveGoal();
                        document.getElementById('goalDisplay').style.opacity = '1';
                        document.getElementById('goalAlert').classList.add('hidden');
                        document.getElementById('goalAlert').innerHTML = `<p class="text-xs font-bold text-emerald-400">สำเร็จแล้ว! ระบบจะรีเซ็ตใน <span id="countdown">10</span> วินาที</p>`;
                        render();
                    }, 3000);
                }
            }, 1000);
        }

        document.getElementById('txForm').onsubmit = (e) => {
            e.preventDefault();
            if (!data.isOnline) return;

            const tx = {
                id: Date.now(),
                title: document.getElementById('title').value,
                amount: parseFloat(document.getElementById('amount').value),
                type: document.getElementById('type').value,
                date: new Date().toISOString(),
                isArchived: false
            };

            data.transactions.push(tx);
            save();
            render();
            e.target.reset();
        };

        function openGoalSettings() { document.getElementById('goalModal').classList.remove('hidden'); }
        function closeGoalSettings() { document.getElementById('goalModal').classList.add('hidden'); }
        
        function saveGoalSettings() {
            data.goal.name = document.getElementById('setGoalName').value || data.goal.name;
            data.goal.target = parseFloat(document.getElementById('setGoalTarget').value) || data.goal.target;
            saveGoal();
            closeGoalSettings();
            render();
        }

        function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(data.transactions)); }
        function saveGoal() { localStorage.setItem(GOAL_KEY, JSON.stringify(data.goal)); }

        window.onload = init;
    </script>
</body>
</html>
