<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Nexus v68.0.0 MetaAI 9.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --meta-primary: #06b6d4;
            --meta-bg: #0f172a;
            --meta-card: #1e293b;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--meta-bg);
            color: #f1f5f9;
            font-size: 18px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á ‡πÑ‡∏°‡πà‡πÄ‡∏•‡πá‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
            line-height: 1.6;
        }

        .font-kanit { font-family: 'Kanit', sans-serif; }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
        }

        .ai-pulse-border {
            border-left: 6px solid var(--meta-primary);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .input-style {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 10px 15px;
            color: white;
            width: 100%;
        }

        .btn-upgrade {
            background: linear-gradient(90deg, #06b6d4 0%, #3b82f6 100%);
            transition: all 0.3s ease;
        }

        .btn-upgrade:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .countdown-text {
            color: #fb7185;
            font-weight: bold;
            font-family: monospace;
        }

        /* Progress Bar Animation */
        .progress-container {
            height: 10px;
            background: #334155;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22d3ee, #818cf8);
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <!-- Header Section -->
        <header class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
            <div>
                <span class="text-cyan-400 font-bold text-sm tracking-widest uppercase">Version 68.0.0 Platinum</span>
                <h1 class="text-4xl font-bold font-kanit">Finance <span class="text-cyan-400">Nexus AI</span></h1>
            </div>
            <div class="glass-card p-4 px-8 text-right border-cyan-500/20">
                <p class="text-xs text-slate-400 uppercase font-bold">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                <div id="balanceDisplay" class="text-4xl font-bold font-kanit text-white">‡∏ø0.00</div>
            </div>
        </header>

        <!-- AI Insight Section -->
        <div class="glass-card p-6 mb-8 ai-pulse-border relative overflow-hidden">
            <div class="flex items-center gap-3 mb-3">
                <div class="w-3 h-3 bg-cyan-400 rounded-full animate-ping"></div>
                <h2 class="font-bold font-kanit text-lg">MetaAI 9.0 Analysis</h2>
            </div>
            <div id="aiResponse" class="text-slate-300 italic">
                ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Form & Goal -->
            <div class="space-y-6">
                <!-- Goal Section -->
                <div class="glass-card p-6 border-l-4 border-indigo-500">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold font-kanit">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</h3>
                        <button onclick="editGoal()" class="text-xs text-cyan-400 hover:underline">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span id="goalNameDisplay">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</span>
                            <span id="goalPercentDisplay" class="font-bold text-cyan-400">0%</span>
                        </div>
                        <div class="progress-container">
                            <div id="goalBar" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="goalAmountDisplay" class="text-[10px] text-slate-500 text-right uppercase font-bold">Target: ‡∏ø0</p>
                    </div>
                </div>

                <!-- Input Section -->
                <div class="glass-card p-6">
                    <h3 class="font-bold font-kanit mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
                    <form id="txForm" class="space-y-4">
                        <input type="text" id="desc" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô)" class="input-style" required>
                        <div class="grid grid-cols-2 gap-2">
                            <select id="type" class="input-style">
                                <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                                <option value="expense" selected>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                            </select>
                            <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" class="input-style" required>
                        </div>
                        <select id="category" class="input-style">
                            <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üç± ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                            <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                            <option value="‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å">üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å/‡∏ö‡∏¥‡∏•</option>
                            <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á">üé¨ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                            <option value="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û">üíä ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‚ú® ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                        <button type="submit" class="btn-upgrade w-full py-3 rounded-xl font-bold font-kanit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
                    </form>
                </div>
            </div>

            <!-- Visualization & History -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Charts Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass-card p-4 h-[280px]">
                        <h4 class="text-xs font-bold text-slate-500 mb-2 uppercase">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h4>
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="glass-card p-4 h-[280px]">
                        <h4 class="text-xs font-bold text-slate-500 mb-2 uppercase">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</h4>
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>

                <!-- History Section -->
                <div class="glass-card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold font-kanit">‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Private View)</h3>
                        <span class="text-[10px] text-rose-400 font-bold animate-pulse">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                    </div>
                    <div id="historyList" class="space-y-3">
                        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏°‡∏≤‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                        <div class="text-center py-8 text-slate-600 italic text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center p-4 z-50">
        <div class="glass-card p-8 w-full max-w-sm">
            <h3 class="text-xl font-bold font-kanit mb-4">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <div class="space-y-4">
                <input type="text" id="goalTitle" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" class="input-style">
                <input type="number" id="goalTarget" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" class="input-style">
                <button onclick="saveGoal()" class="btn-upgrade w-full py-3 rounded-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
            </div>
        </div>
    </div>

    <script>
        // Data Configuration
        const CURRENT_DB = 'finance_nexus_v68';
        const LEGACY_KEYS = ['finance_nexus_v66', 'meta_finance_v64', 'meta_finance_v62'];

        let data = {
            transactions: [],
            goal: { title: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏°", target: 10000 },
            sessionIds: [] // ‡πÄ‡∏Å‡πá‡∏ö id ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
        };

        let pieChart, lineChart;

        // Initialize App
        function init() {
            const saved = localStorage.getItem(CURRENT_DB);
            if (saved) {
                data = JSON.parse(saved);
                // Reset sessionIds ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
                data.sessionIds = [];
            } else {
                // Legacy Migration
                for (const key of LEGACY_KEYS) {
                    const oldData = localStorage.getItem(key);
                    if (oldData) {
                        const parsed = JSON.parse(oldData);
                        data.transactions = parsed.transactions || parsed.records || [];
                        data.goal = parsed.goal || data.goal;
                        console.log("Migrated data from: " + key);
                        saveData();
                        break;
                    }
                }
            }
            updateUI();
            startCountdownTimer();
        }

        function saveData() {
            localStorage.setItem(CURRENT_DB, JSON.stringify(data));
            updateUI();
        }

        function updateUI() {
            const income = data.transactions.filter(t => t.type === 'income').reduce((a, b) => a + Number(b.amount), 0);
            const expense = data.transactions.filter(t => t.type === 'expense').reduce((a, b) => a + Number(b.amount), 0);
            const balance = income - expense;

            // Balance
            document.getElementById('balanceDisplay').innerText = `‡∏ø${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;

            // Goal
            const pct = data.goal.target > 0 ? Math.min(100, (balance / data.goal.target) * 100) : 0;
            document.getElementById('goalNameDisplay').innerText = data.goal.title;
            document.getElementById('goalPercentDisplay').innerText = `${pct.toFixed(1)}%`;
            document.getElementById('goalBar').style.width = `${pct}%`;
            document.getElementById('goalAmountDisplay').innerText = `Target: ‡∏ø${data.goal.target.toLocaleString()}`;

            // AI & Financial Status
            processAI(balance, income, expense);

            // History
            renderHistory();

            // Charts
            renderCharts();
        }

        function processAI(bal, inc, exp) {
            const box = document.getElementById('aiResponse');
            if (data.transactions.length === 0) {
                box.innerHTML = `<span class="text-slate-500 italic">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•...</span>`;
                return;
            }

            const expRate = inc > 0 ? (exp / inc) * 100 : (exp > 0 ? 100 : 0);
            let status = "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°";
            let color = "text-cyan-400";
            let advice = "‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö";

            if (bal < 0) {
                status = "‡∏ß‡∏¥‡∏Å‡∏§‡∏ï";
                color = "text-rose-400";
                advice = "‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ' ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ";
            } else if (expRate > 70) {
                status = "‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á";
                color = "text-amber-400";
                advice = "‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡∏Å‡∏ß‡πà‡∏≤ " + expRate.toFixed(0) + "% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ‡∏Ñ‡∏ß‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°";
            }

            box.innerHTML = `
                <div>
                    <span class="font-bold font-kanit ${color}">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${status}</span>
                    <p class="mt-1 text-slate-300">
                        <strong class="text-cyan-400">AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</strong> ${advice}
                    </p>
                </div>
            `;
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            const now = Date.now();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô sessionIds ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            const recent = data.transactions.filter(t => {
                const sessionInfo = data.sessionIds.find(s => s.id === t.id);
                if (!sessionInfo) return false;
                return (now - sessionInfo.addedAt) < 60000;
            }).reverse();

            if (recent.length === 0) {
                list.innerHTML = `<div class="text-center py-8 text-slate-600 italic text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å)</div>`;
                return;
            }

            list.innerHTML = recent.map(t => {
                const sessionInfo = data.sessionIds.find(s => s.id === t.id);
                const secondsLeft = Math.max(0, Math.floor((60000 - (now - sessionInfo.addedAt)) / 1000));
                return `
                    <div class="flex justify-between items-center p-4 bg-slate-800/40 rounded-xl border border-white/5">
                        <div class="flex items-center gap-3">
                            <div class="text-2xl">${getCategoryEmoji(t.category)}</div>
                            <div>
                                <div class="font-bold text-sm">${t.desc}</div>
                                <div class="text-[10px] uppercase text-slate-500 font-bold">
                                    ${t.category} ‚Ä¢ <span class="countdown-text">‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô ${secondsLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="${t.type === 'income' ? 'text-cyan-400' : 'text-rose-400'} font-bold">
                                ${t.type === 'income' ? '+' : '-'}‡∏ø${Number(t.amount).toLocaleString()}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getCategoryEmoji(cat) {
            const map = { '‡∏≠‡∏≤‡∏´‡∏≤‡∏£': 'üç±', '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á': 'üöó', '‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å': 'üè†', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á': 'üé¨', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û': 'üíä', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': '‚ú®' };
            return map[cat] || 'üí∞';
        }

        function renderCharts() {
            const ctxPie = document.getElementById('pieChart').getContext('2d');
            const ctxLine = document.getElementById('lineChart').getContext('2d');

            // Data for Pie
            const expenses = data.transactions.filter(t => t.type === 'expense');
            const catMap = {};
            expenses.forEach(e => catMap[e.category] = (catMap[e.category] || 0) + Number(e.amount));

            if (pieChart) pieChart.destroy();
            pieChart = new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catMap),
                    datasets: [{
                        data: Object.values(catMap),
                        backgroundColor: ['#06b6d4', '#3b82f6', '#818cf8', '#a78bfa', '#fb7185', '#94a3b8'],
                        borderWidth: 0
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#94a3b8', font: { family: 'Sarabun', size: 10 } } } } }
            });

            // Data for Line (Balance Trend)
            let runningBal = 0;
            const trend = data.transactions.map(t => {
                runningBal += (t.type === 'income' ? Number(t.amount) : -Number(t.amount));
                return runningBal;
            }).slice(-10);

            if (lineChart) lineChart.destroy();
            lineChart = new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: trend.map((_, i) => i + 1),
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
                        data: trend,
                        borderColor: '#06b6d4',
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(6, 182, 212, 0.1)'
                    }]
                },
                options: { 
                    maintainAspectRatio: false, 
                    scales: { x: { display: false }, y: { grid: { color: '#334155' }, ticks: { color: '#64748b', font: { size: 9 } } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- Logic Functions ---

        document.getElementById('txForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = Date.now();
            const newTx = {
                id: id,
                desc: document.getElementById('desc').value,
                amount: document.getElementById('amount').value,
                type: document.getElementById('type').value,
                category: document.getElementById('category').value
            };

            data.transactions.push(newTx);
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô sessionIds ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
            data.sessionIds.push({ id: id, addedAt: Date.now() });
            
            saveData();
            e.target.reset();
        });

        function startCountdownTimer() {
            setInterval(() => {
                const now = Date.now();
                const initialLength = data.sessionIds.length;
                
                // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                data.sessionIds = data.sessionIds.filter(s => (now - s.addedAt) < 60000);
                
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÑ‡∏õ) ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                if (data.sessionIds.length !== initialLength || data.sessionIds.length > 0) {
                    renderHistory();
                }
            }, 1000);
        }

        function editGoal() {
            document.getElementById('goalModal').classList.remove('hidden');
            document.getElementById('goalModal').classList.add('flex');
            document.getElementById('goalTitle').value = data.goal.title;
            document.getElementById('goalTarget').value = data.goal.target;
        }

        function saveGoal() {
            data.goal.title = document.getElementById('goalTitle').value || "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢";
            data.goal.target = Number(document.getElementById('goalTarget').value) || 0;
            saveData();
            document.getElementById('goalModal').classList.add('hidden');
            document.getElementById('goalModal').classList.remove('flex');
        }

        // Start App
        init();
    </script>
</body>
</html>
