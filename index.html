<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Nexus v58.0.0 - MetaAI 5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --meta-primary: #0ea5e9;
            --meta-secondary: #8b5cf6;
            --meta-bg: #0f172a;
            --meta-card: rgba(30, 41, 59, 0.8);
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #020617 0%, #0f172a 100%);
            color: #f1f5f9;
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (18px) */
            font-size: 18px;
            line-height: 1.6;
            min-height: 100vh;
        }

        h1, h2, h3, .font-kanit { font-family: 'Kanit', sans-serif; }

        .meta-glass {
            background: var(--meta-card);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }

        .meta-input {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 14px;
            color: white;
            width: 100%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .meta-input:focus {
            outline: none;
            border-color: var(--meta-primary);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .meta-button {
            background: linear-gradient(90deg, var(--meta-primary), var(--meta-secondary));
            border-radius: 12px;
            padding: 14px;
            font-weight: 600;
            color: white;
            transition: all 0.3s;
            text-align: center;
        }

        .meta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
            filter: brightness(1.1);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 99px;
            font-size: 14px;
            font-weight: 600;
        }

        .progress-container {
            height: 14px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 99px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9, #8b5cf6, #d946ef);
            transition: width 1.2s ease-out;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <!-- Dashboard Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="bg-blue-600 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-tighter">AI Powered</span>
                    <h1 class="text-3xl font-bold tracking-tight text-white">METAAI <span class="text-blue-400">5.0</span></h1>
                </div>
                <p class="text-slate-400 font-kanit">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Finance Nexus v58.0.0 (Data Migrated)</p>
            </div>
            
            <div class="meta-glass px-8 py-4 text-center min-w-[240px]">
                <p class="text-xs uppercase text-slate-500 font-bold mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                <div id="displayBalance" class="text-4xl font-bold text-white tracking-tighter">‡∏ø0.00</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: AI Input & Goal -->
            <div class="space-y-8">
                
                <!-- Meta Goal Tracker -->
                <div class="meta-glass p-6">
                    <div class="flex justify-between items-start mb-6">
                        <h3 class="font-bold text-white">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Meta</h3>
                        <button onclick="toggleModal('goalModal', true)" class="text-blue-400 text-sm hover:underline">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
                    </div>
                    <div id="goalContent">
                        <div class="mb-2 flex justify-between">
                            <span id="goalTitle" class="text-slate-300 font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                            <span id="goalPercent" class="text-blue-400 font-bold">0%</span>
                        </div>
                        <div class="progress-container mb-2">
                            <div id="goalProgress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="goalSummary" class="text-sm text-slate-500">‡∏ø0.00 ‡∏à‡∏≤‡∏Å ‡∏ø0.00</p>
                    </div>
                </div>

                <!-- Transaction Form -->
                <div class="meta-glass p-6">
                    <h3 class="font-bold text-white mb-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</h3>
                    <form id="txForm" class="space-y-4">
                        <input type="text" id="label" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." required class="meta-input">
                        <div class="grid grid-cols-2 gap-4">
                            <select id="type" class="meta-input">
                                <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                                <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                            </select>
                            <select id="category" class="meta-input">
                                <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üç¥ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                                <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                                <option value="‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á">üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</option>
                                <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á">üéÆ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                                <option value="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û">üè• ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‚ú® ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                        <input type="number" id="amount" placeholder="‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô..." required class="meta-input text-2xl font-bold text-blue-400">
                        <button type="submit" class="meta-button w-full text-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡πà‡∏≤‡∏ô MetaAI</button>
                    </form>
                </div>
            </div>

            <!-- Middle/Right Column: Analytics -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Charts Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="meta-glass p-6 h-[300px]">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h4>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="meta-glass p-6 h-[300px]">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- History -->
                <div class="meta-glass p-6 overflow-hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-white">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ Meta Ledger</h3>
                        <div id="aiSuggestion" class="text-xs text-blue-400 bg-blue-900/30 px-3 py-1 rounded-full border border-blue-500/30">
                            MetaAI 5.0 ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                        </div>
                    </div>
                    <div id="txList" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                        <!-- Items rendered here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-md hidden items-center justify-center p-6">
        <div class="meta-glass p-8 w-full max-w-md">
            <h3 class="text-xl font-bold text-white mb-6">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="space-y-4">
                <input type="text" id="modalGoalTitle" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢..." class="meta-input">
                <input type="number" id="modalGoalTarget" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô..." class="meta-input">
                <div class="flex gap-4">
                    <button onclick="saveGoal()" class="meta-button flex-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                    <button onclick="toggleModal('goalModal', false)" class="flex-1 text-slate-500 font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö Migration
        const STORAGE_KEY = 'nexus_v58_meta_store';
        const LEGACY_STORAGE = ['nexus_v56_data', 'nexus_v54_store', 'nexus_v53_storage', 'nexus_ledger'];

        let appState = {
            transactions: [],
            goal: { title: "‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏≠‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß", target: 50000 }
        };

        let charts = { cat: null, line: null };

        function init() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                appState = JSON.parse(saved);
            } else {
                // ‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏Å‡πà‡∏≤ (v56 -> v58)
                for (const key of LEGACY_STORAGE) {
                    const legacy = localStorage.getItem(key);
                    if (legacy) {
                        const parsed = JSON.parse(legacy);
                        appState.transactions = Array.isArray(parsed) ? parsed : (parsed.transactions || []);
                        if (parsed.goal) appState.goal = parsed.goal;
                        console.log(`Migration v58: Data imported from ${key}`);
                        saveData();
                        break;
                    }
                }
            }
            render();
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
            render();
        }

        function toggleModal(id, show) {
            document.getElementById(id).classList.toggle('hidden', !show);
            document.getElementById(id).classList.toggle('flex', show);
        }

        function saveGoal() {
            const title = document.getElementById('modalGoalTitle').value;
            const target = document.getElementById('modalGoalTarget').value;
            if (title && target) {
                appState.goal = { title, target: parseFloat(target) };
                saveData();
                toggleModal('goalModal', false);
            }
        }

        function deleteItem(idx) {
            appState.transactions.splice(idx, 1);
            saveData();
        }

        document.getElementById('txForm').onsubmit = (e) => {
            e.preventDefault();
            const tx = {
                label: document.getElementById('label').value,
                type: document.getElementById('type').value,
                category: document.getElementById('category').value,
                amount: parseFloat(document.getElementById('amount').value),
                date: new Date().toISOString()
            };
            appState.transactions.push(tx);
            saveData();
            e.target.reset();
        };

        function render() {
            const totalIn = appState.transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
            const totalOut = appState.transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
            const balance = totalIn - totalOut;

            // Balance Display
            document.getElementById('displayBalance').innerText = '‡∏ø' + balance.toLocaleString(undefined, {minimumFractionDigits: 2});

            // Goal Display
            document.getElementById('goalTitle').innerText = appState.goal.title;
            const progress = Math.min(100, Math.max(0, (balance / appState.goal.target) * 100));
            document.getElementById('goalProgress').style.width = progress + '%';
            document.getElementById('goalPercent').innerText = Math.round(progress) + '%';
            document.getElementById('goalSummary').innerText = `‡∏ø${balance.toLocaleString()} ‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏ø${appState.goal.target.toLocaleString()}`;

            // AI Insight Placeholder
            const insightText = balance < 0 ? "MetaAI: ‡∏£‡∏∞‡∏ß‡∏±‡∏á! ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö" : "MetaAI: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡∏µ‡∏°‡∏≤‡∏Å";
            document.getElementById('aiSuggestion').innerText = insightText;

            // List Display
            const list = document.getElementById('txList');
            list.innerHTML = appState.transactions.slice().reverse().map((t, i) => {
                const realIdx = appState.transactions.length - 1 - i;
                return `
                <div class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/5 hover:border-blue-500/30 transition-all group">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg flex items-center justify-center bg-slate-800 font-bold">
                            ${t.type === 'income' ? 'üíπ' : 'üìâ'}
                        </div>
                        <div>
                            <p class="font-bold text-white leading-tight">${t.label}</p>
                            <p class="text-sm text-slate-500">${t.category} ‚Ä¢ ${new Date(t.date).toLocaleDateString('th-TH')}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold ${t.type === 'income' ? 'text-emerald-400' : 'text-rose-400'}">
                            ${t.type === 'income' ? '+' : '-'} ${t.amount.toLocaleString()}
                        </p>
                        <button onclick="deleteItem(${realIdx})" class="text-[10px] text-slate-700 hover:text-rose-500 uppercase font-black opacity-0 group-hover:opacity-100 transition-opacity">Delete</button>
                    </div>
                </div>
            `}).join('');

            updateCharts();
        }

        function updateCharts() {
            // Category Pie
            const expenses = appState.transactions.filter(t => t.type === 'expense');
            const catMap = {};
            expenses.forEach(t => catMap[t.category] = (catMap[t.category] || 0) + t.amount);

            const catCtx = document.getElementById('categoryChart').getContext('2d');
            if (charts.cat) charts.cat.destroy();
            charts.cat = new Chart(catCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catMap),
                    datasets: [{
                        data: Object.values(catMap),
                        backgroundColor: ['#0ea5e9', '#8b5cf6', '#d946ef', '#f43f5e', '#10b981', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: { legend: { position: 'bottom', labels: { color: '#64748b', font: { family: 'Sarabun' } } } }
                }
            });

            // Trend Chart
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            let runningBalance = 0;
            const trendPoints = appState.transactions.map(t => {
                runningBalance += (t.type === 'income' ? t.amount : -t.amount);
                return runningBalance;
            }).slice(-10);

            if (charts.line) charts.line.destroy();
            charts.line = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: trendPoints.map((_, i) => i + 1),
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°',
                        data: trendPoints,
                        borderColor: '#0ea5e9',
                        backgroundColor: 'rgba(14, 165, 233, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#0ea5e9'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        window.onload = init;
    </script>
</body>
</html>
