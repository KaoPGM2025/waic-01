<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Nexus 41.0.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700;800&family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --nexus-primary: #6366f1;
            --nexus-success: #10b981;
            --nexus-danger: #f43f5e;
        }
        body { font-family: 'Sarabun', sans-serif; background-color: #020617; color: #f1f5f9; min-height: 100vh; }
        .font-kanit { font-family: 'Kanit', sans-serif; }
        .nexus-card { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 24px; }
        
        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--nexus-success); }
        input:checked + .slider:before { transform: translateX(24px); }

        .progress-fill { transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(245, 158, 11, 0); } 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); } }
        .goal-complete { animation: pulse-gold 2s infinite; }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Top Navigation -->
    <nav class="max-w-2xl mx-auto flex justify-between items-center mb-8 px-2">
        <div>
            <h1 class="text-xl font-black tracking-tighter text-indigo-400">NEXUS <span class="text-white">41.0.0</span></h1>
            <div id="statusIndicator" class="flex items-center gap-1.5 mt-1">
                <span id="statusDot" class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <span id="statusText" class="text-[10px] font-bold uppercase tracking-widest text-emerald-500">System Online</span>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <label class="switch">
                <input type="checkbox" id="onlineToggle" checked onchange="handleOnlineToggle()">
                <span class="slider"></span>
            </label>
            <button onclick="openSettings()" class="text-slate-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
            </button>
        </div>
    </nav>

    <main class="max-w-2xl mx-auto space-y-6">
        
        <!-- Total Balance View -->
        <section class="nexus-card p-8 bg-gradient-to-br from-indigo-900/20 to-transparent border-indigo-500/20">
            <p class="text-[10px] font-bold text-indigo-400 uppercase tracking-[0.3em] mb-2">Net Worth Portfolio</p>
            <div class="flex items-baseline gap-2">
                <span class="text-2xl font-light opacity-50">‡∏ø</span>
                <h2 id="displayBalance" class="text-5xl font-black font-kanit tracking-tighter">0.00</h2>
            </div>
        </section>

        <!-- Goal Section -->
        <section id="goalContainer" class="nexus-card p-6 border-amber-500/10">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="font-bold text-amber-500 text-sm uppercase tracking-wider">Financial Goal</h3>
                    <p id="goalNameDisplay" class="text-xl font-black font-kanit text-slate-200">No Active Goal</p>
                </div>
                <button onclick="openGoalSettings()" class="text-[10px] font-black uppercase text-amber-500/60 hover:text-amber-500">Configure</button>
            </div>

            <div id="goalProgressWrapper" class="hidden">
                <div class="h-3 bg-slate-800 rounded-full overflow-hidden mb-3">
                    <div id="goalProgressBar" class="progress-fill h-full bg-gradient-to-r from-amber-600 to-yellow-400 w-0"></div>
                </div>
                <div class="flex justify-between text-[11px] font-bold">
                    <span id="goalPercentText" class="text-amber-500">0%</span>
                    <span id="goalStatusText" class="opacity-40">‡∏ø0 / ‡∏ø0</span>
                </div>
            </div>

            <!-- Auto-Reset Notification -->
            <div id="goalCompleteNotif" class="hidden mt-4 p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-2xl flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="flex h-3 w-3 relative">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                    </span>
                    <p class="text-xs font-bold text-emerald-400">Goal Complete! Purging in <span id="purgeTimer">10</span>s</p>
                </div>
            </div>
        </section>

        <!-- Form Module -->
        <section id="formModule" class="nexus-card p-6 relative overflow-hidden">
            <div id="offlineOverlay" class="absolute inset-0 bg-slate-950/80 backdrop-blur-md z-10 flex flex-col items-center justify-center hidden">
                <svg class="w-12 h-12 text-rose-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                <p class="text-xs font-black uppercase tracking-widest text-rose-500">System Offline</p>
            </div>

            <form id="txForm" class="space-y-4">
                <input type="text" id="txLabel" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô..." required class="w-full bg-slate-800/40 border border-white/5 p-4 rounded-2xl focus:border-indigo-500 outline-none transition-all text-sm">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="txAmount" placeholder="0.00" required class="w-full bg-slate-800/40 border border-white/5 p-4 rounded-2xl focus:border-indigo-500 outline-none transition-all font-black">
                    <select id="txType" class="bg-slate-800/40 border border-white/5 p-4 rounded-2xl font-bold outline-none cursor-pointer">
                        <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                        <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-500 p-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all transform active:scale-[0.98] shadow-lg shadow-indigo-600/20">Record Flow</button>
            </form>
        </section>

        <!-- Transaction History -->
        <div class="flex justify-between items-center px-2">
            <h3 class="text-[10px] font-black uppercase opacity-40 tracking-widest">Rolling History (48H Cycle)</h3>
            <span class="text-[9px] font-bold text-indigo-400 bg-indigo-400/10 px-2 py-0.5 rounded-full">AUTO-PURGE ENABLED</span>
        </div>
        <div id="historyList" class="space-y-3">
            <!-- Items injected by JS -->
        </div>
    </main>

    <!-- Modal Overlays -->
    <div id="modalBackdrop" class="fixed inset-0 bg-slate-950/90 backdrop-blur-xl z-[100] hidden items-center justify-center p-6">
        
        <!-- Goal Setup -->
        <div id="goalModal" class="nexus-card p-8 w-full max-w-sm hidden border-amber-500/20">
            <h3 class="text-lg font-black font-kanit text-amber-500 mb-6 uppercase">Set New Goal</h3>
            <div class="space-y-4">
                <input type="text" id="newGoalName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢..." class="w-full bg-slate-900 border border-white/10 p-4 rounded-2xl outline-none">
                <input type="number" id="newGoalTarget" placeholder="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)..." class="w-full bg-slate-900 border border-white/10 p-4 rounded-2xl outline-none font-black">
                <div class="flex gap-3 pt-2">
                    <button onclick="saveGoal()" class="flex-1 bg-amber-500 text-slate-950 font-black p-4 rounded-2xl text-[10px] uppercase tracking-widest">Initialize</button>
                    <button onclick="closeModals()" class="flex-1 bg-slate-800 text-white font-black p-4 rounded-2xl text-[10px] uppercase tracking-widest">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Master Settings -->
        <div id="settingsModal" class="nexus-card p-8 w-full max-w-sm hidden border-rose-500/20">
            <h3 class="text-lg font-black font-kanit text-indigo-400 mb-6 uppercase tracking-widest text-center">Security & Wipe</h3>
            <div class="space-y-6">
                <div class="p-4 bg-indigo-500/5 rounded-2xl border border-indigo-500/10">
                    <p class="text-[10px] font-black text-indigo-400 uppercase mb-2">History Management</p>
                    <p class="text-[11px] opacity-60 leading-relaxed">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡πÜ 2 ‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏ï‡πà‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ</p>
                </div>
                <div class="pt-4 border-t border-white/5">
                    <p class="text-[10px] font-black text-rose-500 uppercase mb-3 text-center">Nuclear Factory Reset</p>
                    <button onclick="confirmReset()" class="w-full bg-rose-500/10 hover:bg-rose-500 text-rose-500 hover:text-white border border-rose-500/20 p-4 rounded-2xl text-[10px] font-black uppercase transition-all">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</button>
                </div>
                <button onclick="closeModals()" class="w-full text-[10px] font-black uppercase opacity-30 mt-4">Close Settings</button>
            </div>
        </div>
    </div>

    <script>
        // --- Nexus Persistence Engine v41.0.0 ---
        const KEYS = {
            TX: 'nexus_v41_transactions',
            VAULT: 'nexus_v41_vault',
            GOAL: 'nexus_v41_goal',
            CONFIG: 'nexus_v41_config'
        };

        let state = {
            transactions: [],
            vaultBalance: 0,
            goal: null,
            online: true
        };

        // --- 1. Data Migration (‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢) ---
        function migrateLegacyData() {
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô v40 ‡∏´‡∏£‡∏∑‡∏≠ keys ‡πÄ‡∏Å‡πà‡∏≤)
            const oldTx = localStorage.getItem('nx41_transactions') || localStorage.getItem('transactions') || '[]';
            const oldVault = localStorage.getItem('nx41_vault_balance') || localStorage.getItem('total_balance') || '0';
            const oldGoal = localStorage.getItem('nx41_goal_data') || localStorage.getItem('goal_data') || 'null';

            // ‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô v41
            if (!localStorage.getItem(KEYS.TX)) {
                localStorage.setItem(KEYS.TX, oldTx);
                localStorage.setItem(KEYS.VAULT, oldVault);
                localStorage.setItem(KEYS.GOAL, oldGoal);
                console.log("Migration Complete: All data from previous versions synced.");
            }
        }

        // --- 2. System Core ---
        function loadState() {
            state.transactions = JSON.parse(localStorage.getItem(KEYS.TX) || '[]');
            state.vaultBalance = parseFloat(localStorage.getItem(KEYS.VAULT) || '0');
            state.goal = JSON.parse(localStorage.getItem(KEYS.GOAL) || 'null');
            const config = JSON.parse(localStorage.getItem(KEYS.CONFIG) || '{"online": true}');
            state.online = config.online;
        }

        function saveState() {
            localStorage.setItem(KEYS.TX, JSON.stringify(state.transactions));
            localStorage.setItem(KEYS.VAULT, state.vaultBalance.toString());
            localStorage.setItem(KEYS.GOAL, JSON.stringify(state.goal));
            localStorage.setItem(KEYS.CONFIG, JSON.stringify({ online: state.online }));
        }

        function autoPurge() {
            const now = Date.now();
            const TWO_DAYS = 2 * 24 * 60 * 60 * 1000;
            
            const toPurge = state.transactions.filter(t => (now - new Date(t.date).getTime()) >= TWO_DAYS);
            
            if (toPurge.length > 0) {
                // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Vault
                toPurge.forEach(t => {
                    if (t.type === 'income') state.vaultBalance += parseFloat(t.amount);
                    else state.vaultBalance -= parseFloat(t.amount);
                });

                state.transactions = state.transactions.filter(t => (now - new Date(t.date).getTime()) < TWO_DAYS);
                saveState();
                console.log(`[Auto-Purge] ${toPurge.length} items moved to permanent vault storage.`);
            }
        }

        // --- 3. UI Interactions ---
        function render() {
            // Update Balance
            let currentFlow = 0;
            state.transactions.forEach(t => {
                if (t.type === 'income') currentFlow += parseFloat(t.amount);
                else currentFlow -= parseFloat(t.amount);
            });
            const totalNet = state.vaultBalance + currentFlow;
            document.getElementById('displayBalance').innerText = totalNet.toLocaleString(undefined, {minimumFractionDigits: 2});

            // Update Goal
            renderGoal(totalNet);

            // Update Online/Offline UI
            document.getElementById('onlineToggle').checked = state.online;
            document.getElementById('offlineOverlay').classList.toggle('hidden', state.online);
            document.getElementById('statusDot').className = `w-2 h-2 rounded-full ${state.online ? 'bg-emerald-500 animate-pulse' : 'bg-rose-500'}`;
            document.getElementById('statusText').innerText = state.online ? "System Online" : "System Offline";
            document.getElementById('statusText').className = `text-[10px] font-bold uppercase tracking-widest ${state.online ? 'text-emerald-500' : 'text-rose-500'}`;

            // Update History
            const historyList = document.getElementById('historyList');
            if (state.transactions.length === 0) {
                historyList.innerHTML = `<div class="text-center py-10 opacity-20 text-[10px] font-black uppercase tracking-widest italic">No flow detected</div>`;
            } else {
                historyList.innerHTML = state.transactions.slice().reverse().map(t => `
                    <div class="nexus-card p-4 flex justify-between items-center group">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl flex items-center justify-center ${t.type === 'income' ? 'bg-emerald-500/10 text-emerald-500' : 'bg-rose-500/10 text-rose-500'}">
                                ${t.type === 'income' ? '‚Üô' : '‚Üó'}
                            </div>
                            <div>
                                <p class="text-xs font-bold">${t.label}</p>
                                <p class="text-[8px] opacity-30 font-black uppercase">${new Date(t.date).toLocaleString('th-TH')}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-kanit font-black ${t.type === 'income' ? 'text-emerald-400' : 'text-rose-400'}">
                                ${t.type === 'income' ? '+' : '-'} ${parseFloat(t.amount).toLocaleString()}
                            </p>
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderGoal(currentTotal) {
            const wrapper = document.getElementById('goalProgressWrapper');
            const nameDisp = document.getElementById('goalNameDisplay');
            
            if (state.goal) {
                wrapper.classList.remove('hidden');
                nameDisp.innerText = state.goal.name;
                
                const percent = Math.min(100, Math.floor((currentTotal / state.goal.target) * 100));
                document.getElementById('goalProgressBar').style.width = `${percent}%`;
                document.getElementById('goalPercentText').innerText = `${percent}%`;
                document.getElementById('goalStatusText').innerText = `‡∏ø${currentTotal.toLocaleString()} / ‡∏ø${state.goal.target.toLocaleString()}`;
                
                if (percent >= 100) handleGoalCompletion();
            } else {
                wrapper.classList.add('hidden');
                nameDisp.innerText = "No Active Goal";
            }
        }

        let isPurgingGoal = false;
        function handleGoalCompletion() {
            if (isPurgingGoal) return;
            isPurgingGoal = true;

            const notif = document.getElementById('goalCompleteNotif');
            const timerText = document.getElementById('purgeTimer');
            document.getElementById('goalContainer').classList.add('goal-complete');
            notif.classList.remove('hidden');

            let count = 10;
            const interval = setInterval(() => {
                count--;
                timerText.innerText = count;
                if (count <= 0) {
                    clearInterval(interval);
                    
                    // ‡∏•‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Auto-delete in 10s)
                    state.goal = null;
                    saveState();
                    notif.classList.add('hidden');
                    document.getElementById('goalContainer').classList.remove('goal-complete');
                    render();
                    isPurgingGoal = false;

                    // ‡πÄ‡∏õ‡∏¥‡∏î Financial Goal ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                    setTimeout(() => {
                        openGoalSettings();
                    }, 3000);
                }
            }, 1000);
        }

        // --- 4. Handlers ---
        function handleOnlineToggle() {
            state.online = document.getElementById('onlineToggle').checked;
            saveState();
            render();
        }

        document.getElementById('txForm').onsubmit = (e) => {
            e.preventDefault();
            if (!state.online) return;

            const label = document.getElementById('txLabel').value;
            const amount = parseFloat(document.getElementById('txAmount').value);
            const type = document.getElementById('txType').value;

            state.transactions.push({
                label, amount, type, date: new Date().toISOString()
            });

            saveState();
            render();
            e.target.reset();
        };

        function saveGoal() {
            const name = document.getElementById('newGoalName').value;
            const target = parseFloat(document.getElementById('newGoalTarget').value);
            if (name && target > 0) {
                state.goal = { name, target };
                saveState();
                closeModals();
                render();
            }
        }

        function confirmReset() {
            if (confirm("üö® ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡∏°‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function openGoalSettings() {
            document.getElementById('modalBackdrop').style.display = 'flex';
            document.getElementById('goalModal').classList.remove('hidden');
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function openSettings() {
            document.getElementById('modalBackdrop').style.display = 'flex';
            document.getElementById('settingsModal').classList.remove('hidden');
            document.getElementById('goalModal').classList.add('hidden');
        }

        function closeModals() {
            document.getElementById('modalBackdrop').style.display = 'none';
        }

        // --- Initialize ---
        window.onload = () => {
            migrateLegacyData();
            loadState();
            autoPurge();
            render();

            // Check auto purge every hour
            setInterval(autoPurge, 3600000);
        };
    </script>
</body>
</html>
