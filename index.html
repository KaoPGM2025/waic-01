<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Nexus v62.0.0 MetaAI 5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --meta-ai-primary: #10b981; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏£‡∏Å‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö v62 */
            --meta-ai-secondary: #3b82f6;
            --bg-deep: #0f172a;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 100%, #1e293b 0%, #0f172a 100%);
            color: #f1f5f9;
            /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
            font-size: 18.5px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .font-kanit { font-family: 'Kanit', sans-serif; }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        .ai-status-badge {
            background: linear-gradient(90deg, #10b981, #3b82f6);
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            color: white;
        }

        .input-meta {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            color: white;
            width: 100%;
        }

        .btn-meta {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 12px;
            padding: 14px;
            font-weight: 600;
            color: white;
            transition: all 0.2s;
        }

        .btn-meta:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }

        .ai-analysis-box {
            border: 1px solid rgba(16, 185, 129, 0.2);
            background: rgba(16, 185, 129, 0.03);
            border-radius: 16px;
            padding: 20px;
        }

        .progress-bar-bg {
            height: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <div class="flex items-center gap-3 mb-1">
                    <span class="ai-status-badge">v62.0.0 MetaAI 5.0</span>
                </div>
                <h1 class="text-4xl font-bold font-kanit text-white">FINANCE <span class="text-emerald-400">NEXUS</span></h1>
                <p class="text-slate-400">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‚Ä¢ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</p>
            </div>
            <div class="text-right glass-card p-4 px-8 border-emerald-500/20">
                <p class="text-xs font-bold text-emerald-500 uppercase tracking-widest">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏ß‡∏°</p>
                <h2 id="balanceDisplay" class="text-4xl font-bold text-white tracking-tighter">‡∏ø0.00</h2>
            </div>
        </header>

        <!-- AI Intelligent Analysis Section -->
        <section class="glass-card p-6 mb-8">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                    <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
                </div>
                <h3 class="text-xl font-bold font-kanit text-emerald-400">MetaAI 5.0 Analysis</h3>
            </div>
            <div id="aiInsight" class="ai-analysis-box text-slate-300 min-h-[80px] flex items-center">
                <p class="italic text-slate-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ MetaAI ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Panel -->
            <div class="space-y-6">
                <!-- Multi-Goal -->
                <div class="glass-card p-6 border-l-4 border-emerald-500">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold font-kanit">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Goals)</h3>
                        <button onclick="openGoalSettings()" class="text-emerald-400 text-sm hover:underline">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-2">
                                <span id="goalTitle" class="text-slate-300 text-sm">‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</span>
                                <span id="goalTarget" class="font-bold text-sm">‡∏ø0.00</span>
                            </div>
                            <div class="progress-bar-bg">
                                <div id="goalBar" class="h-full bg-emerald-500 rounded-lg transition-all duration-1000" style="width: 0%"></div>
                            </div>
                            <p id="goalRemaining" class="text-[14px] text-slate-500 mt-2 text-right"></p>
                        </div>
                    </div>
                </div>

                <!-- Transaction Form -->
                <div class="glass-card p-6">
                    <h3 class="font-bold font-kanit mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</h3>
                    <form id="financeForm" class="space-y-4">
                        <input type="text" id="desc" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£" required class="input-meta">
                        <div class="grid grid-cols-2 gap-3">
                            <select id="type" class="input-meta">
                                <option value="in">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                                <option value="out" selected>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                            </select>
                            <input type="number" id="amt" placeholder="0.00" required class="input-meta">
                        </div>
                        <select id="cat" class="input-meta">
                            <option value="‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö">üí∞ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å</option>
                            <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üç± ‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                            <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                            <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á">üé¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                            <option value="‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å">üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å/‡∏ö‡∏¥‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÜ</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                        <button type="submit" class="btn-meta w-full font-kanit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                    </form>
                </div>
            </div>

            <!-- Right Panel: Graphs & History -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Analytics -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-card p-4 h-[280px]">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h4>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="glass-card p-4 h-[280px]">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h4>
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Transaction History -->
                <div class="glass-card p-6">
                    <h3 class="font-bold font-kanit mb-4 flex justify-between items-center">
                        ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        <span id="itemCount" class="text-xs font-normal text-slate-500 uppercase tracking-widest">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </h3>
                    <div id="txList" class="space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Items rendered by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-slate-950/90 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="glass-card w-full max-w-md p-8 border-emerald-500/30">
            <h3 class="text-2xl font-bold font-kanit mb-6">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <div class="space-y-4">
                <label class="block text-sm text-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
                <input type="text" id="setGoalTitle" class="input-meta">
                <label class="block text-sm text-slate-400">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏ó)</label>
                <input type="number" id="setGoalAmt" class="input-meta">
                <div class="flex gap-4 pt-4">
                    <button onclick="saveSettings()" class="btn-meta flex-1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="closeGoalSettings()" class="flex-1 text-slate-400 hover:text-white transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'finance_nexus_v62';
        const LEGACY_KEYS = ['meta_finance_v60', 'nexus_v56_data']; // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å v60 ‡πÅ‡∏•‡∏∞ v56

        let state = {
            transactions: [],
            goal: { title: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì", target: 100000 },
            version: "62.0.0"
        };

        let charts = {};

        function init() {
            // Check for v62 data
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                state = JSON.parse(saved);
            } else {
                // Migration Logic
                for (const key of LEGACY_KEYS) {
                    const legacy = localStorage.getItem(key);
                    if (legacy) {
                        const parsed = JSON.parse(legacy);
                        state.transactions = parsed.transactions || [];
                        if (parsed.goal) state.goal = parsed.goal;
                        console.log(`v62.0.0: Data successfully migrated from ${key}`);
                        break;
                    }
                }
            }
            refreshUI();
        }

        function refreshUI() {
            const income = state.transactions.filter(t => t.type === 'in').reduce((s, t) => s + Number(t.amt), 0);
            const expense = state.transactions.filter(t => t.type === 'out').reduce((s, t) => s + Number(t.amt), 0);
            const balance = income - expense;

            // Header & Counter
            document.getElementById('balanceDisplay').innerText = `‡∏ø${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('itemCount').innerText = `${state.transactions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

            // Goal
            document.getElementById('goalTitle').innerText = state.goal.title;
            document.getElementById('goalTarget').innerText = `‡∏ø${state.goal.target.toLocaleString()}`;
            const progress = state.goal.target > 0 ? Math.min(100, (balance / state.goal.target) * 100) : 0;
            document.getElementById('goalBar').style.width = `${progress}%`;
            document.getElementById('goalRemaining').innerText = balance >= state.goal.target ? 
                '‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß!' : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ‡∏ø${(state.goal.target - balance).toLocaleString()}`;

            // History List
            const listEl = document.getElementById('txList');
            if (state.transactions.length === 0) {
                listEl.innerHTML = `<div class="text-center py-10 text-slate-500 italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>`;
            } else {
                listEl.innerHTML = state.transactions.slice().reverse().map((t, idx) => `
                    <div class="flex justify-between items-center p-4 bg-slate-800/40 rounded-xl hover:bg-slate-800/60 transition">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-slate-900 flex items-center justify-center text-xl">
                                ${t.type === 'in' ? 'ü™ô' : 'üßæ'}
                            </div>
                            <div>
                                <p class="font-bold text-white">${t.desc}</p>
                                <p class="text-[12px] text-slate-500 uppercase tracking-widest">${t.cat} ‚Ä¢ ${new Date(t.date).toLocaleDateString('th-TH')}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold ${t.type === 'in' ? 'text-emerald-400' : 'text-rose-400'}">
                                ${t.type === 'in' ? '+' : '-'} ${Number(t.amt).toLocaleString()}
                            </p>
                            <button onclick="removeTx(${state.transactions.length - 1 - idx})" class="text-[10px] text-slate-600 hover:text-rose-500">‡∏•‡∏ö‡∏≠‡∏≠‡∏Å</button>
                        </div>
                    </div>
                `).join('');
            }

            updateAI(balance, income, expense);
            updateCharts();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function updateAI(balance, income, expense) {
            const insightBox = document.getElementById('aiInsight');
            
            // Feature v62: ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
            if (state.transactions.length === 0) {
                insightBox.innerHTML = `<p class="italic text-slate-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ MetaAI ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</p>`;
                return;
            }

            const expenseRatio = income > 0 ? (expense / income) * 100 : 0;
            let statusBadge = "";
            let message = "";

            if (balance < 0) {
                statusBadge = "üõë ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö";
                message = "MetaAI ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏•‡∏ö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏†‡∏≤‡∏û";
            } else if (expenseRatio > 70) {
                statusBadge = "‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á (Spending High)";
                message = `‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${expenseRatio.toFixed(1)}% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô`;
            } else if (income > 0 && balance > (income * 0.3)) {
                statusBadge = "‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (Healthy)";
                message = "‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 30% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏±‡∏ö";
            } else {
                statusBadge = "üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏õ‡∏Å‡∏ï‡∏¥";
                message = "‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î";
            }

            insightBox.innerHTML = `<div><p class="font-bold text-white mb-2">${statusBadge}</p><p class="text-[16px]">${message}</p></div>`;
        }

        function updateCharts() {
            const catCtx = document.getElementById('categoryChart').getContext('2d');
            const trendCtx = document.getElementById('trendChart').getContext('2d');

            // Data Prep for Categories
            const cats = {};
            state.transactions.filter(t => t.type === 'out').forEach(t => cats[t.cat] = (cats[t.cat] || 0) + Number(t.amt));
            
            if (charts.cat) charts.cat.destroy();
            charts.cat = new Chart(catCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cats),
                    datasets: [{
                        data: Object.values(cats),
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'],
                        borderWidth: 0
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8', font: { size: 10, family: 'Sarabun' } } } }
                }
            });

            // Data Prep for Trend (last 10)
            let running = 0;
            const trendData = state.transactions.map(t => {
                running += (t.type === 'in' ? Number(t.amt) : -Number(t.amt));
                return running;
            }).slice(-10);

            if (charts.trend) charts.trend.destroy();
            charts.trend = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: trendData.map((_, i) => i + 1),
                    datasets: [{
                        data: trendData,
                        borderColor: '#10b981',
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 0,
                        fill: true,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- Interaction ---
        document.getElementById('financeForm').onsubmit = (e) => {
            e.preventDefault();
            const tx = {
                desc: document.getElementById('desc').value,
                amt: document.getElementById('amt').value,
                type: document.getElementById('type').value,
                cat: document.getElementById('cat').value,
                date: new Date().toISOString()
            };
            state.transactions.push(tx);
            refreshUI();
            e.target.reset();
        };

        function removeTx(idx) {
            state.transactions.splice(idx, 1);
            refreshUI();
        }

        function openGoalSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            document.getElementById('settingsModal').classList.add('flex');
            document.getElementById('setGoalTitle').value = state.goal.title;
            document.getElementById('setGoalAmt').value = state.goal.target;
        }

        function closeGoalSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
            document.getElementById('settingsModal').classList.remove('flex');
        }

        function saveSettings() {
            state.goal.title = document.getElementById('setGoalTitle').value || "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà";
            state.goal.target = Number(document.getElementById('setGoalAmt').value) || 0;
            refreshUI();
            closeGoalSettings();
        }

        window.onload = init;
    </script>
</body>
</html>
