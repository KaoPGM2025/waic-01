<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Nexus v62.3.0 MetaAI 5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --meta-ai-cyan: #22d3ee;
            --meta-ai-indigo: #6366f1;
            --bg-dark: #0f172a;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 0% 0%, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠ */
            font-size: 18px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .font-kanit { font-family: 'Kanit', sans-serif; }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .status-badge {
            background: linear-gradient(135deg, #22d3ee, #6366f1);
            color: white;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .input-field {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            color: white;
            width: 100%;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--meta-ai-cyan);
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.2);
        }

        .btn-action {
            background: linear-gradient(to right, #06b6d4, #3b82f6);
            transition: all 0.3s;
            border-radius: 12px;
            padding: 12px;
            font-weight: bold;
            color: white;
        }

        .btn-action:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .progress-bg {
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #22d3ee, #6366f1);
            transition: width 0.8s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        .ai-border {
            border-left: 5px solid var(--meta-ai-cyan);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Version Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end mb-8 gap-4">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <span class="status-badge">v62.3.0 MetaAI 5.0</span>
                </div>
                <h1 class="text-4xl font-bold font-kanit text-white uppercase tracking-tight">Finance <span class="text-cyan-400">Nexus</span></h1>
            </div>
            <div class="text-left sm:text-right">
                <p class="text-slate-400 text-sm font-bold uppercase tracking-widest">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                <h2 id="balance" class="text-5xl font-bold font-kanit text-white">‡∏ø0.00</h2>
            </div>
        </div>

        <!-- AI Insight (‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) -->
        <div class="glass-panel p-6 mb-8 ai-border">
            <div class="flex items-center gap-3 mb-3">
                <div class="w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                    <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" stroke-width="2"></path></svg>
                </div>
                <h3 class="font-bold text-lg font-kanit">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô & AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>
            </div>
            <div id="aiSummary" class="text-slate-300 italic">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: MetaAI ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Form & Goal (Left) -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Goal Card -->
                <div class="glass-panel p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold font-kanit text-white">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h4>
                        <button onclick="openGoalEdit()" class="text-xs text-cyan-400">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    </div>
                    <div id="goalDisplay" class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span id="goalName" class="text-slate-400 italic">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>
                            <span id="goalPercent" class="text-cyan-400 font-bold">0%</span>
                        </div>
                        <div class="progress-bg">
                            <div id="goalProgress" class="progress-bar" style="width: 0%"></div>
                        </div>
                        <p id="goalRemaining" class="text-xs text-slate-500 text-right">0 / 0</p>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="glass-panel p-6">
                    <h4 class="font-bold font-kanit text-white mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h4>
                    <form id="financeForm" class="space-y-4">
                        <input type="text" id="txName" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡πÅ‡∏ü" class="input-field" required>
                        <div class="grid grid-cols-2 gap-2">
                            <select id="txType" class="input-field">
                                <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                                <option value="expense" selected>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                            </select>
                            <input type="number" id="txAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="input-field" required>
                        </div>
                        <select id="txCat" class="input-field">
                            <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                            <option value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                            <option value="‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å">üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å/‡∏ö‡∏¥‡∏•</option>
                            <option value="‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á">üçø ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                            <option value="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û">üè• ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üåÄ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                        <button type="submit" class="btn-action w-full font-kanit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                    </form>
                </div>
            </div>

            <!-- Visualization & History (Right) -->
            <div class="lg:col-span-8 space-y-6">
                <!-- Charts Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel p-5 h-64 flex flex-col">
                        <h5 class="text-xs font-bold text-slate-500 uppercase mb-4 tracking-tighter">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h5>
                        <div class="flex-grow relative">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    <div class="glass-panel p-5 h-64 flex flex-col">
                        <h5 class="text-xs font-bold text-slate-500 uppercase mb-4 tracking-tighter">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h5>
                        <div class="flex-grow relative">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- History -->
                <div class="glass-panel p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold font-kanit text-white">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                        <span id="txCount" class="text-xs text-slate-500">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div id="txList" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                        <!-- Items inject here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-slate-950/90 backdrop-blur-sm hidden items-center justify-center p-4 z-50">
        <div class="glass-panel p-8 w-full max-w-md border-cyan-500/30">
            <h3 class="text-xl font-bold font-kanit mb-6">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="space-y-4">
                <input type="text" id="editGoalName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î" class="input-field">
                <input type="number" id="editGoalTarget" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" class="input-field">
                <div class="flex gap-2">
                    <button onclick="saveGoalSettings()" class="btn-action flex-1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="closeGoalEdit()" class="flex-1 text-slate-400">‡∏õ‡∏¥‡∏î</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Keys for Legacy Support
        const V62_KEY = 'meta_finance_v62';
        const V60_KEY = 'meta_finance_v60';

        let appState = {
            transactions: [],
            goal: { name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß", target: 30000 },
            lastUpdate: new Date().toISOString()
        };

        let myCharts = { cat: null, trend: null };

        // 1. Initial & Migration
        function initApp() {
            const v62Data = localStorage.getItem(V62_KEY);
            const v60Data = localStorage.getItem(V60_KEY);

            if (v62Data) {
                appState = JSON.parse(v62Data);
            } else if (v60Data) {
                // Migration logic
                const old = JSON.parse(v60Data);
                appState.transactions = old.transactions || [];
                appState.goal = old.goal || appState.goal;
                console.log("v62.3.0: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡∏π‡∏Å‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                saveState();
            }

            renderAll();
        }

        function saveState() {
            localStorage.setItem(V62_KEY, JSON.stringify(appState));
            renderAll();
        }

        // 2. Rendering
        function renderAll() {
            const income = appState.transactions.filter(t => t.type === 'income').reduce((s, t) => s + Number(t.amt), 0);
            const expense = appState.transactions.filter(t => t.type === 'expense').reduce((s, t) => s + Number(t.amt), 0);
            const currentBalance = income - expense;

            // Header Balance
            document.getElementById('balance').innerText = `‡∏ø${currentBalance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;

            // Goal Rendering
            document.getElementById('goalName').innerText = appState.goal.name;
            const percent = appState.goal.target > 0 ? (currentBalance / appState.goal.target) * 100 : 0;
            const safePercent = Math.max(0, Math.min(100, percent)).toFixed(1);
            document.getElementById('goalPercent').innerText = `${safePercent}%`;
            document.getElementById('goalProgress').style.width = `${safePercent}%`;
            document.getElementById('goalRemaining').innerText = `${currentBalance.toLocaleString()} / ${appState.goal.target.toLocaleString()}`;

            // History
            const listContainer = document.getElementById('txList');
            document.getElementById('txCount').innerText = `${appState.transactions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            listContainer.innerHTML = appState.transactions.slice().reverse().map((t, idx) => `
                <div class="flex justify-between items-center p-4 bg-white/5 rounded-xl border border-white/5">
                    <div class="flex items-center gap-3">
                        <div class="text-2xl">${getEmoji(t.cat)}</div>
                        <div>
                            <div class="font-bold text-white text-sm">${t.name}</div>
                            <div class="text-xs text-slate-500">${new Date(t.date).toLocaleDateString('th-TH')}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${t.type === 'income' ? 'text-cyan-400' : 'text-indigo-400'}">
                            ${t.type === 'income' ? '+' : '-'} ${Number(t.amt).toLocaleString()}
                        </div>
                        <button onclick="deleteTx(${appState.transactions.length - 1 - idx})" class="text-[10px] text-slate-700 hover:text-red-400 uppercase">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');

            updateAI(currentBalance, income, expense);
            updateCharts();
        }

        function getEmoji(cat) {
            const map = { '‡∏≠‡∏≤‡∏´‡∏≤‡∏£': 'üçΩÔ∏è', '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á': 'üöó', '‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å': 'üè†', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á': 'üçø', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û': 'üè•', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': 'üåÄ' };
            return map[cat] || 'üí∞';
        }

        // 3. MetaAI 5.0 Precision Analysis
        function updateAI(balance, income, expense) {
            const aiBox = document.getElementById('aiSummary');
            
            if (appState.transactions.length === 0) {
                aiBox.innerHTML = "<em>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: MetaAI ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</em>";
                return;
            }

            const expenseRatio = income > 0 ? (expense / income) * 100 : 100;
            let statusText = "";
            let aiAdvice = "";

            if (balance < 0) {
                statusText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï (‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏∞‡∏™‡∏°)";
                aiAdvice = "‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á MetaAI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' ‡πÅ‡∏•‡∏∞ '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á' ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏î‡∏∏‡∏•";
            } else if (expenseRatio > 75) {
                statusText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á (‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á)";
                aiAdvice = "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô " + expenseRatio.toFixed(0) + "% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û";
            } else if (balance > appState.goal.target) {
                statusText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢)";
                aiAdvice = "‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ö‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô";
            } else {
                statusText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á (‡∏õ‡∏Å‡∏ï‡∏¥)";
                aiAdvice = "‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏á‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏°‡πà‡∏ä‡πâ‡∏≤";
            }

            aiBox.innerHTML = `<span class="text-cyan-400 font-bold font-kanit">${statusText}</span><br><span class="text-slate-400">${aiAdvice}</span>`;
        }

        // 4. Automated Charts
        function updateCharts() {
            // Category Pie
            const catMap = {};
            appState.transactions.filter(t => t.type === 'expense').forEach(t => {
                catMap[t.cat] = (catMap[t.cat] || 0) + Number(t.amt);
            });

            const catLabels = Object.keys(catMap);
            const catData = Object.values(catMap);

            if (myCharts.cat) myCharts.cat.destroy();
            myCharts.cat = new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut',
                data: {
                    labels: catLabels,
                    datasets: [{
                        data: catData,
                        backgroundColor: ['#22d3ee', '#6366f1', '#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#64748b', font: { family: 'Sarabun', size: 10 } } } }
                }
            });

            // Trend Line
            let running = 0;
            const trendData = appState.transactions.map(t => {
                running += (t.type === 'income' ? Number(t.amt) : -Number(t.amt));
                return running;
            }).slice(-10);

            if (myCharts.trend) myCharts.trend.destroy();
            myCharts.trend = new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: trendData.map((_, i) => i + 1),
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
                        data: trendData,
                        borderColor: '#22d3ee',
                        backgroundColor: 'rgba(34, 211, 238, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 2
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: { 
                        x: { display: false },
                        y: { ticks: { color: '#475569', font: { size: 10 } }, grid: { color: 'rgba(255,255,255,0.05)' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // 5. User Interaction
        document.getElementById('financeForm').onsubmit = (e) => {
            e.preventDefault();
            const newTx = {
                name: document.getElementById('txName').value,
                amt: document.getElementById('txAmount').value,
                type: document.getElementById('txType').value,
                cat: document.getElementById('txCat').value,
                date: new Date().toISOString()
            };
            appState.transactions.push(newTx);
            saveState();
            e.target.reset();
        };

        function deleteTx(idx) {
            appState.transactions.splice(idx, 1);
            saveState();
        }

        function openGoalEdit() {
            document.getElementById('editGoalName').value = appState.goal.name;
            document.getElementById('editGoalTarget').value = appState.goal.target;
            document.getElementById('goalModal').classList.replace('hidden', 'flex');
        }

        function closeGoalEdit() {
            document.getElementById('goalModal').classList.replace('flex', 'hidden');
        }

        function saveGoalSettings() {
            appState.goal.name = document.getElementById('editGoalName').value || "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢";
            appState.goal.target = Number(document.getElementById('editGoalTarget').value) || 0;
            saveState();
            closeGoalEdit();
        }

        // Startup
        window.onload = initApp;
    </script>
</body>
</html>
