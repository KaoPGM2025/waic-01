<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Nexus v66.0.0 MetaAI 9.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --meta-ai-9-glow: #22d3ee;
            --meta-ai-9-deep: #083344;
            --bg-canvas: #0b0f1a;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-canvas);
            color: #e2e8f0;
            font-size: 18.5px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á Standard */
            line-height: 1.7;
        }

        .font-kanit { font-family: 'Kanit', sans-serif; }

        .glass-panel {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(34, 211, 238, 0.15);
            border-radius: 28px;
        }

        .ai-active-border {
            border-left: 5px solid var(--meta-ai-9-glow);
            box-shadow: -10px 0 20px -10px rgba(34, 211, 238, 0.3);
        }

        .input-field {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 12px 16px;
            color: white;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--meta-ai-9-glow);
            box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.2);
        }

        .btn-v66 {
            background: linear-gradient(135deg, #22d3ee, #3b82f6);
            color: white;
            padding: 14px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(34, 211, 238, 0.2);
        }

        .btn-v66:active { transform: scale(0.98); }

        .privacy-countdown {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            color: #fb7185;
        }

        .progress-bar-bg {
            height: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #22d3ee, #818cf8);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="p-4 sm:p-8 md:p-12">

    <div class="max-w-7xl mx-auto">
        <!-- Header Section -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6">
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="bg-cyan-500/10 text-cyan-400 text-[10px] font-bold px-3 py-1 rounded-full border border-cyan-500/20">META AI 9.0 QUANTUM</span>
                </div>
                <h1 class="text-4xl font-bold font-kanit tracking-tighter">FINANCE <span class="text-cyan-400">NEXUS v66</span></h1>
            </div>
            <div class="glass-panel p-6 px-10 border-cyan-500/30">
                <p class="text-slate-400 text-xs uppercase font-bold tracking-widest mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                <h2 id="totalBalance" class="text-5xl font-bold font-kanit text-white">‡∏ø0.00</h2>
            </div>
        </header>

        <!-- MetaAI Analysis Center -->
        <section class="glass-panel p-8 mb-10 ai-active-border">
            <div class="flex items-center gap-4 mb-4">
                <div class="p-3 bg-cyan-500/20 rounded-2xl">
                    <svg class="w-8 h-8 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                </div>
                <div>
                    <h3 class="font-bold text-xl font-kanit">MetaAI 9.0 Intelligence</h3>
                    <p class="text-xs text-cyan-500/60 uppercase tracking-widest">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</p>
                </div>
            </div>
            <div id="aiInsight" class="text-slate-300 min-h-[50px] flex items-center italic">
                <span class="text-slate-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå AI...</span>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Data Entry & Goals -->
            <div class="space-y-8">
                <!-- Percentage Goal Tracking -->
                <div class="glass-panel p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="font-bold font-kanit">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</h4>
                        <button onclick="setNewGoal()" class="text-[10px] bg-white/5 hover:bg-white/10 px-3 py-1 rounded-lg transition">‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</button>
                    </div>
                    <div id="goalContent" class="space-y-4">
                        <div class="flex justify-between items-end">
                            <span id="gName" class="text-sm text-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span>
                            <span id="gPercent" class="text-3xl font-bold text-cyan-400">0%</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div id="gBar" class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-[11px] font-bold text-slate-500">
                            <span>0</span>
                            <span id="gTargetDisplay">TARGET: ‡∏ø0</span>
                        </div>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="glass-panel p-6">
                    <h4 class="font-bold font-kanit mb-6 flex items-center gap-2">
                        <span class="w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></span>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
                    </h4>
                    <form id="financeForm" class="space-y-4">
                        <input type="text" id="desc" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£" class="input-field w-full" required>
                        <div class="grid grid-cols-2 gap-3">
                            <select id="type" class="input-field">
                                <option value="in">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
                                <option value="out" selected>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                            </select>
                            <input type="number" id="amt" placeholder="0.00" class="input-field" required>
                        </div>
                        <select id="cat" class="input-field w-full">
                            <option value="Food">üç± ‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                            <option value="Travel">üöó ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                            <option value="Bills">üè† ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡πÑ‡∏ü/‡∏ö‡∏¥‡∏•</option>
                            <option value="Shopping">üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</option>
                            <option value="Health">‚öïÔ∏è ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                            <option value="Other">‚ú® ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                        <button type="submit" class="btn-v66 w-full font-kanit mt-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </form>
                </div>
            </div>

            <!-- Visualization & Privacy History -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Charts Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel p-6">
                        <h5 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î</h5>
                        <div class="h-[220px]">
                            <canvas id="chartPie"></canvas>
                        </div>
                    </div>
                    <div class="glass-panel p-6">
                        <h5 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
                        <div class="h-[220px]">
                            <canvas id="chartLine"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions with Countdown -->
                <div class="glass-panel p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="font-bold font-kanit flex items-center gap-2">
                            ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                            <span id="privacyStatus" class="hidden text-[10px] bg-rose-500/20 text-rose-400 px-2 py-0.5 rounded border border-rose-500/20 animate-pulse">PRIVACY FILTER ON</span>
                        </h4>
                        <span class="text-[11px] text-slate-500 uppercase font-bold">‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                    </div>
                    <div id="txList" class="space-y-3 min-h-[100px]">
                        <!-- List Items -->
                        <div class="text-center py-10 text-slate-600 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center p-6 z-50">
        <div class="glass-panel p-8 w-full max-w-md border-cyan-500/50">
            <h3 class="text-2xl font-bold font-kanit mb-6 text-cyan-400">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <div class="space-y-4">
                <input type="text" id="goalInputName" class="input-field w-full" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏£‡∏¥‡∏õ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô)">
                <input type="number" id="goalInputTarget" class="input-field w-full" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏ó)">
                <div class="flex gap-3 pt-4">
                    <button onclick="confirmGoal()" class="btn-v66 flex-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                    <button onclick="closeGoalModal()" class="flex-1 text-slate-400 font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database Keys
        const DB_KEY = 'finance_nexus_v66';
        const LEGACY_KEYS = ['meta_finance_v62', 'meta_finance_v64', 'meta_finance_v64.4.0'];

        let appState = {
            transactions: [],
            goal: { name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß", target: 20000 },
            visibleIds: [] // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ
        };

        let pieChart = null;
        let lineChart = null;

        function init() {
            // Load Data with Legacy Support
            const saved = localStorage.getItem(DB_KEY);
            if (saved) {
                appState = JSON.parse(saved);
            } else {
                // Check older versions
                for (const key of LEGACY_KEYS) {
                    const oldData = localStorage.getItem(key);
                    if (oldData) {
                        const parsed = JSON.parse(oldData);
                        appState.transactions = parsed.records || parsed.transactions || [];
                        appState.goal = parsed.goal || appState.goal;
                        console.log(`v66: ‡∏≠‡∏û‡∏¢‡∏û‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ${key} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                        save();
                        break;
                    }
                }
            }

            // Reset visible session IDs (Only new ones in this session show countdown)
            appState.visibleIds = [];
            
            updateUI();
            startGlobalTimer();
        }

        function save() {
            localStorage.setItem(DB_KEY, JSON.stringify(appState));
            updateUI();
        }

        function updateUI() {
            const income = appState.transactions.filter(t => t.type === 'in').reduce((s, t) => s + Number(t.amt), 0);
            const expense = appState.transactions.filter(t => t.type === 'out').reduce((s, t) => s + Number(t.amt), 0);
            const balance = income - expense;

            // Header Balance
            document.getElementById('totalBalance').innerText = `‡∏ø${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;

            // Goals
            const gPercent = appState.goal.target > 0 ? (balance / appState.goal.target) * 100 : 0;
            const safePct = Math.min(100, Math.max(0, gPercent)).toFixed(1);
            document.getElementById('gName').innerText = appState.goal.name;
            document.getElementById('gPercent').innerText = `${safePct}%`;
            document.getElementById('gBar').style.width = `${safePct}%`;
            document.getElementById('gTargetDisplay').innerText = `TARGET: ‡∏ø${appState.goal.target.toLocaleString()}`;

            // AI Analysis & Financial Status
            renderAI(balance, income, expense);

            // Transaction List
            renderTransactions();

            // Charts
            renderCharts();
        }

        function renderAI(bal, inc, exp) {
            const aiBox = document.getElementById('aiInsight');
            if (appState.transactions.length === 0) {
                aiBox.innerHTML = `<span class="text-slate-500 italic">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå AI...</span>`;
                return;
            }

            const expRatio = inc > 0 ? (exp / inc) * 100 : (exp > 0 ? 100 : 0);
            let status = "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (Healthy)";
            let color = "text-cyan-400";
            let advice = "‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏°‡∏µ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡πÑ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤";

            if (bal < 0) {
                status = "‡∏ß‡∏¥‡∏Å‡∏§‡∏ï (Alert)";
                color = "text-rose-500";
                advice = "‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö! ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô";
            } else if (expRatio > 75) {
                status = "‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á (Warning)";
                color = "text-amber-400";
                advice = "‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô " + expRatio.toFixed(0) + "%) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ";
            }

            aiBox.innerHTML = `
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="font-bold font-kanit ${color}">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô: ${status}</span>
                    </div>
                    <p class="text-slate-300 leading-relaxed">
                        <span class="text-cyan-400 font-bold">MetaAI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</span> ${advice}
                    </p>
                </div>
            `;
        }

        function renderTransactions() {
            const list = document.getElementById('txList');
            const visible = appState.transactions.filter(t => appState.visibleIds.includes(t.id)).reverse();
            
            if (visible.length === 0) {
                list.innerHTML = `<div class="text-center py-10 text-slate-600 text-sm italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)</div>`;
                document.getElementById('privacyStatus').classList.add('hidden');
                return;
            }

            document.getElementById('privacyStatus').classList.remove('hidden');
            
            list.innerHTML = visible.map(t => {
                const timeLeft = Math.max(0, Math.floor((60000 - (Date.now() - t.id)) / 1000));
                return `
                <div class="flex justify-between items-center p-4 bg-slate-900/50 rounded-2xl border border-white/5">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-lg">
                            ${getIcon(t.cat)}
                        </div>
                        <div>
                            <div class="font-bold text-slate-200 text-sm">${t.desc}</div>
                            <div class="text-[10px] uppercase tracking-wider text-slate-500 flex items-center gap-2">
                                <span>${t.cat}</span> ‚Ä¢ 
                                <span class="privacy-countdown">HIDE IN: ${timeLeft}s</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${t.type === 'in' ? 'text-cyan-400' : 'text-rose-400'}">
                            ${t.type === 'in' ? '+' : '-'} ${Number(t.amt).toLocaleString()}
                        </div>
                        <button onclick="permanentDelete(${t.id})" class="text-[9px] text-slate-700 hover:text-rose-500 uppercase font-bold transition">‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderCharts() {
            // Data for Pie
            const cats = {};
            appState.transactions.filter(t => t.type === 'out').forEach(t => {
                cats[t.cat] = (cats[t.cat] || 0) + Number(t.amt);
            });

            const ctxPie = document.getElementById('chartPie').getContext('2d');
            if (pieChart) pieChart.destroy();
            pieChart = new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cats),
                    datasets: [{
                        data: Object.values(cats),
                        backgroundColor: ['#22d3ee', '#3b82f6', '#818cf8', '#6366f1', '#4f46e5', '#ec4899'],
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'bottom', labels: { color: '#94a3b8', font: { family: 'Sarabun', size: 10 } } }
                    },
                    cutout: '70%'
                }
            });

            // Data for Line (Last 10 changes)
            let currentBal = 0;
            const lineData = appState.transactions.map(t => {
                currentBal += (t.type === 'in' ? Number(t.amt) : -Number(t.amt));
                return currentBal;
            }).slice(-15);

            const ctxLine = document.getElementById('chartLine').getContext('2d');
            if (lineChart) lineChart.destroy();
            lineChart = new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: lineData.map((_, i) => i + 1),
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°',
                        data: lineData,
                        borderColor: '#22d3ee',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(34, 211, 238, 0.05)',
                        pointRadius: 4,
                        pointBackgroundColor: '#22d3ee'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#475569', font: { size: 10 } } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function getIcon(c) {
            const icons = { Food:'üç±', Travel:'üöó', Bills:'üè†', Shopping:'üõçÔ∏è', Health:'‚öïÔ∏è', Other:'‚ú®' };
            return icons[c] || 'üí∞';
        }

        // --- Event Handlers ---

        document.getElementById('financeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = Date.now();
            const newTx = {
                id: id,
                desc: document.getElementById('desc').value,
                amt: document.getElementById('amt').value,
                type: document.getElementById('type').value,
                cat: document.getElementById('cat').value
            };

            appState.transactions.push(newTx);
            appState.visibleIds.push(id);
            save();
            e.target.reset();
        });

        function permanentDelete(id) {
            appState.transactions = appState.transactions.filter(t => t.id !== id);
            appState.visibleIds = appState.visibleIds.filter(vId => vId !== id);
            save();
        }

        // --- Privacy & Timer Logic ---

        function startGlobalTimer() {
            setInterval(() => {
                const now = Date.now();
                const beforeCount = appState.visibleIds.length;
                
                // Remove IDs that are older than 60 seconds
                appState.visibleIds = appState.visibleIds.filter(id => (now - id) < 60000);
                
                if (appState.visibleIds.length !== beforeCount || appState.visibleIds.length > 0) {
                    renderTransactions();
                }
            }, 1000);
        }

        // --- Goal Modal Logic ---

        function setNewGoal() {
            document.getElementById('goalModal').classList.remove('hidden');
            document.getElementById('goalModal').classList.add('flex');
            document.getElementById('goalInputName').value = appState.goal.name;
            document.getElementById('goalInputTarget').value = appState.goal.target;
        }

        function closeGoalModal() {
            document.getElementById('goalModal').classList.add('hidden');
            document.getElementById('goalModal').classList.remove('flex');
        }

        function confirmGoal() {
            appState.goal.name = document.getElementById('goalInputName').value || "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢";
            appState.goal.target = Number(document.getElementById('goalInputTarget').value) || 0;
            save();
            closeGoalModal();
        }

        // Initialize
        init();
    </script>
</body>
</html>
